<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© DCA Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„ÙÙˆØ±ÙŠ | Ù…ÙÙƒØ±Ø© Ù…Ø³ØªØ«Ù…Ø±</title>
    <link rel="stylesheet" href="navigation.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh; padding: 20px; color: #2c3e50;
        }

        /* ===== Navbar wrapper ===== */
        .navbar-wrapper { max-width: 950px; margin: 0 auto 15px; }

        /* ===== Container ===== */
        .container {
            max-width: 950px; margin: 0 auto;
            background: white; border-radius: 20px;
            padding: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        /* ===== Legal Banner ===== */
        .legal-banner {
            background: #fff3cd; border: 2px solid #ffc107;
            border-radius: 8px; padding: 12px 16px;
            margin-bottom: 25px;
            display: flex; align-items: flex-start; gap: 10px;
        }
        .legal-banner p {
            color: #856404; font-size: 0.85rem;
            font-weight: bold; line-height: 1.5; flex: 1;
        }

        /* ===== Header ===== */
        h1 {
            text-align: center; color: #1e3c72;
            font-size: 2rem; margin-bottom: 8px;
        }
        .subtitle {
            text-align: center; color: #7f8c8d;
            margin-bottom: 30px; font-size: 0.95rem;
        }

        /* ===== Sections ===== */
        .rule-item {
            background: #f8f9fa; border-radius: 15px;
            padding: 25px; margin: 20px 0;
            border-right: 5px solid #2a5298;
        }
        .rule-item h3 {
            color: #1e3c72; margin-bottom: 20px;
            font-size: 1.05rem; border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }

        /* ===== Input Grid ===== */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 18px;
        }
        .input-group { display: flex; flex-direction: column; }
        .input-group label {
            font-weight: bold; font-size: 0.85rem;
            color: #34495e; margin-bottom: 7px;
        }
        .input-group input, .input-group select {
            padding: 11px; border: 2px solid #e0e0e0;
            border-radius: 8px; font-size: 0.95rem;
            transition: border-color 0.3s; background: white;
        }
        .input-group input:focus,
        .input-group select:focus {
            border-color: #2a5298; outline: none; background: #f0f4ff;
        }

        /* hint ØµØºÙŠØ± ØªØ­Øª Ø§Ù„Ø­Ù‚Ù„ */
        .input-hint {
            font-size: 0.75rem; color: #95a5a6; margin-top: 4px;
        }

        /* ===== Calculate Button ===== */
        .calc-btn {
            display: block; width: 100%; padding: 16px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white; border: none; border-radius: 12px;
            font-size: 1.15rem; font-weight: bold;
            cursor: pointer; margin: 25px 0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(30,60,114,0.35);
        }

        /* ===== Results ===== */
        .results-section {
            display: none; margin-top: 10px;
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .verdict-card {
            border-radius: 16px; padding: 28px;
            text-align: center; margin-bottom: 20px;
            color: white;
        }
        .verdict-card h2 { font-size: 1.6rem; margin-bottom: 8px; }
        .verdict-card p  { font-size: 1rem; opacity: 0.9; line-height: 1.6; }

        .verdict-dca    { background: linear-gradient(135deg, #27ae60, #1e8449); }
        .verdict-lump   { background: linear-gradient(135deg, #2980b9, #1a5276); }
        .verdict-tie    { background: linear-gradient(135deg, #7f8c8d, #566573); }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… */
        .numbers-grid {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 15px; margin-bottom: 20px;
        }
        .num-card {
            border-radius: 12px; padding: 20px; text-align: center;
        }
        .num-card.dca-card  { background: #d5f5e3; border: 2px solid #27ae60; }
        .num-card.lump-card { background: #d6eaf8; border: 2px solid #2980b9; }
        .num-card .label { font-size: 0.82rem; color: #555; margin-bottom: 6px; }
        .num-card .value {
            font-size: 1.5rem; font-weight: bold; color: #2c3e50;
        }
        .num-card .sub {
            font-size: 0.78rem; color: #7f8c8d; margin-top: 4px;
        }

        /* Ù…Ù‚Ø§Ø±Ù†Ø© ØªÙØµÙŠÙ„ÙŠØ© */
        .detail-row {
            display: flex; justify-content: space-between;
            align-items: center; padding: 10px 0;
            border-bottom: 1px solid #f0f0f0; font-size: 0.9rem;
        }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { color: #555; }
        .detail-dca   { color: #27ae60; font-weight: bold; }
        .detail-lump  { color: #2980b9; font-weight: bold; }

        /* Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ */
        .chart-wrapper {
            background: #f8f9fa; border-radius: 12px;
            padding: 20px; margin-top: 20px;
        }
        .chart-wrapper h4 {
            color: #1e3c72; margin-bottom: 15px; font-size: 0.95rem;
        }
        .chart-container { position: relative; height: 300px; }

        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠØ© */
        .price-table-wrapper {
            margin-top: 20px; overflow-x: auto;
        }
        .price-table {
            width: 100%; border-collapse: collapse; font-size: 0.85rem;
        }
        .price-table th {
            background: #1e3c72; color: white;
            padding: 10px; text-align: center;
        }
        .price-table td {
            padding: 8px 10px; text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }
        .price-table tr:hover { background: #f0f4ff; }

        /* ===== Reset Button ===== */
        .reset-btn {
            display: block; margin: 20px auto 0;
            padding: 11px 28px; background: #95a5a6;
            color: white; border: none; border-radius: 10px;
            cursor: pointer; font-size: 0.95rem;
            transition: background 0.3s;
        }
        .reset-btn:hover { background: #7f8c8d; }

        /* ===== Responsive ===== */
        @media (max-width: 768px) {
            .container { padding: 20px; }
            h1 { font-size: 1.6rem; }
            .numbers-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<!-- Navbar -->
<div class="navbar-wrapper">
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">ğŸ“ˆ Ù…ÙÙƒØ±Ø© Ù…Ø³ØªØ«Ù…Ø±</a>
            <div class="navbar-menu" id="navbarMenu">
                <a href="index.html"                     class="navbar-item">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="stock_valuation.html"           class="navbar-item">ğŸ“Š ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø³Ù‡Ù…</a>
                <a href="emergency_fund_calculator.html" class="navbar-item">ğŸ›¡ï¸ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</a>
                <a href="average_calculator.html"        class="navbar-item">ğŸ“Š Ù…ØªÙˆØ³Ø· Ø§Ù„Ø´Ø±Ø§Ø¡</a>
                <a href="company_valuation.html"         class="navbar-item">ğŸ¢ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø±ÙƒØ©</a>
                <a href="retirement_calculator.html"     class="navbar-item">ğŸ–ï¸ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</a>
                <a href="portfolio_rating.html"          class="navbar-item">ğŸ›¡ï¸ Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
                <a href="zakat_purification.html"        class="navbar-item">ğŸ•Œ Ø§Ù„Ø²ÙƒØ§Ø©</a>
                <a href="investor_tips.html"             class="navbar-item">âš ï¸ Ù†ØµØ§Ø¦Ø­</a>
                <a href="dca_calculator.html"            class="navbar-item active">ğŸ“… DCA</a>
            </div>
            <button class="navbar-toggle" onclick="toggleNavbar()">â˜°</button>
        </div>
    </nav>
</div>

<div class="container">

    <!-- Legal Banner -->
    <div class="legal-banner">
        <span>âš ï¸</span>
        <p>Ø¥Ù‚Ø±Ø§Ø± Ù‚Ø§Ù†ÙˆÙ†ÙŠ: Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ØªÙ‚Ø¯ÙŠØ±ÙŠØ© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§ÙØªØ±Ø§Ø¶Ø§Øª Ù…Ø¨Ø³Ø·Ø©.
           Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ø§ ØªÙÙ…Ø«Ù‘Ù„ Ø§Ø³ØªØ´Ø§Ø±Ø© Ù…Ø§Ù„ÙŠØ© Ù…Ù„Ø²Ù…Ø©. Ù‚Ø±Ø§Ø± Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± ÙŠÙ‚Ø¹ Ø¹Ù„Ù‰ Ø¹Ø§ØªÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ­Ø¯Ù‡.</p>
    </div>

    <h1>ğŸ“… DCA Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„ÙÙˆØ±ÙŠ</h1>
    <p class="subtitle">Ù‡Ù„ Ø§Ù„Ø£ÙØ¶Ù„ ØªØ´ØªØ±ÙŠ ÙƒÙ„ Ù…Ø¨Ù„ØºÙƒ Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©ØŒ Ø£Ù… ØªÙˆØ²Ø¹Ù‡ Ø¹Ù„Ù‰ Ø£Ø´Ù‡Ø±ØŸ</p>

    <!-- ===== Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ===== -->
    <div class="rule-item">
        <h3>ğŸ’° Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</h3>
        <div class="input-grid">
            <div class="input-group">
                <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</label>
                <input type="number" id="totalAmount"
                       placeholder="Ù…Ø«Ø§Ù„: 100000" min="1">
                <span class="input-hint">Ø¨Ø£ÙŠ Ø¹Ù…Ù„Ø© ØªØ±ÙŠØ¯</span>
            </div>
            <div class="input-group">
                <label>Ø¹Ø¯Ø¯ Ø£Ø´Ù‡Ø± Ø§Ù„ØªÙˆØ²ÙŠØ¹ (DCA)</label>
                <input type="number" id="dcaMonths"
                       placeholder="Ù…Ø«Ø§Ù„: 12" min="2" max="60">
                <span class="input-hint">Ø¨ÙŠÙ† 2 Ùˆ 60 Ø´Ù‡Ø±Ø§Ù‹</span>
            </div>
            <div class="input-group">
                <label>Ø³Ø¹Ø± Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„)</label>
                <input type="number" id="currentPrice"
                       placeholder="Ù…Ø«Ø§Ù„: 50" min="0.01" step="0.01">
            </div>
            <div class="input-group">
                <label>ØªÙˆÙ‚Ø¹ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø³ÙˆÙ‚ Ø®Ù„Ø§Ù„ ÙØªØ±Ø© DCA</label>
                <select id="marketTrend">
                    <option value="">â€” Ø§Ø®ØªØ± â€”</option>
                    <option value="bull_steady">ØµØ§Ø¹Ø¯ Ø¨Ø«Ø¨Ø§Øª (Ù†Ù…Ùˆ ØªØ¯Ø±ÙŠØ¬ÙŠ)</option>
                    <option value="bull_volatile">ØµØ§Ø¹Ø¯ Ù…Ø¹ ØªØ°Ø¨Ø°Ø¨</option>
                    <option value="bear_steady">Ù‡Ø§Ø¨Ø· Ø¨Ø«Ø¨Ø§Øª</option>
                    <option value="bear_volatile">Ù‡Ø§Ø¨Ø· Ù…Ø¹ ØªØ°Ø¨Ø°Ø¨</option>
                    <option value="sideways">Ø¹Ø±Ø¶ÙŠ (ØªØ°Ø¨Ø°Ø¨ Ø­ÙˆÙ„ Ù†ÙØ³ Ø§Ù„Ø³Ø¹Ø±)</option>
                    <option value="crash_recovery">Ø§Ù†Ù‡ÙŠØ§Ø± Ø«Ù… ØªØ¹Ø§ÙÙŠ</option>
                </select>
                <span class="input-hint">ÙŠÙÙˆÙ„Ù‘Ø¯ Ø£Ø³Ø¹Ø§Ø±Ø§Ù‹ Ø´Ù‡Ø±ÙŠØ© Ù…Ø­Ø§ÙƒØ§Ø©</span>
            </div>
            <div class="input-group">
                <label>Ù†Ø³Ø¨Ø© Ù†Ù…Ùˆ Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ø³Ù†ÙˆÙŠØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ø¨Ø¹Ø¯ DCA (%)</label>
                <input type="number" id="annualGrowth"
                       placeholder="Ù…Ø«Ø§Ù„: 10" step="0.1">
                <span class="input-hint">Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</span>
            </div>
            <div class="input-group">
                <label>Ø£ÙÙ‚ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ DCA (Ø³Ù†ÙˆØ§Øª)</label>
                <input type="number" id="holdYears"
                       placeholder="Ù…Ø«Ø§Ù„: 5" min="1" max="40">
            </div>
        </div>
    </div>

    <button class="calc-btn" onclick="calculate()">ğŸ“Š Ø§Ø­Ø³Ø¨ ÙˆÙ‚Ø§Ø±Ù†</button>

    <!-- ===== Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ===== -->
    <div class="results-section" id="resultsSection">

        <!-- Ø§Ù„Ø­ÙƒÙ… -->
        <div id="verdictCard" class="verdict-card">
            <h2 id="verdictTitle">â€”</h2>
            <p id="verdictText">â€”</p>
        </div>

        <!-- Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div class="numbers-grid">
            <div class="num-card dca-card">
                <div class="label">ğŸ“… DCA â€” Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ©</div>
                <div class="value" id="dcaAvgCost">â€”</div>
                <div class="sub" id="dcaShares">â€”</div>
            </div>
            <div class="num-card lump-card">
                <div class="label">âš¡ Ø´Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ â€” Ø³Ø¹Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
                <div class="value" id="lumpAvgCost">â€”</div>
                <div class="sub" id="lumpShares">â€”</div>
            </div>
            <div class="num-card dca-card">
                <div class="label">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© â€” DCA</div>
                <div class="value" id="dcaFinalValue">â€”</div>
                <div class="sub" id="dcaProfit">â€”</div>
            </div>
            <div class="num-card lump-card">
                <div class="label">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© â€” ÙÙˆØ±ÙŠ</div>
                <div class="value" id="lumpFinalValue">â€”</div>
                <div class="sub" id="lumpProfit">â€”</div>
            </div>
        </div>

        <!-- Ù…Ù‚Ø§Ø±Ù†Ø© ØªÙØµÙŠÙ„ÙŠØ© -->
        <div class="rule-item">
            <h3>ğŸ“‹ Ù…Ù‚Ø§Ø±Ù†Ø© ØªÙØµÙŠÙ„ÙŠØ©</h3>
            <div id="detailRows"></div>
        </div>

        <!-- Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠØ© -->
        <div class="chart-wrapper">
            <h4>ğŸ“ˆ Ù…Ø­Ø§ÙƒØ§Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³Ù‡Ù… Ø®Ù„Ø§Ù„ ÙØªØ±Ø© DCA</h4>
            <div class="chart-container">
                <canvas id="priceChart"></canvas>
            </div>
        </div>

        <!-- Ø±Ø³Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…Ø© -->
        <div class="chart-wrapper">
            <h4>ğŸ’¹ ØªØ·ÙˆØ± Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±Ø© Ø´Ù‡Ø±ÙŠØ§Ù‹ (DCA)</h4>
            <div class="chart-container">
                <canvas id="valueChart"></canvas>
            </div>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
        <div class="rule-item">
            <h3>ğŸ—“ï¸ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø´Ù‡Ø±ÙŠ (DCA)</h3>
            <div class="price-table-wrapper">
                <table class="price-table" id="dcaTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø´Ù‡Ø±</th>
                            <th>Ø³Ø¹Ø± Ø§Ù„Ø³Ù‡Ù…</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±</th>
                            <th>Ø£Ø³Ù‡Ù… Ù…Ø´ØªØ±Ø§Ø©</th>
                            <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ù‡Ù…</th>
                            <th>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                        </tr>
                    </thead>
                    <tbody id="dcaTableBody"></tbody>
                </table>
            </div>
        </div>

        <button class="reset-btn" onclick="resetAll()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
    </div>

</div><!-- end .container -->

<script>
    /* ===== Navbar ===== */
    function toggleNavbar() {
        document.getElementById('navbarMenu').classList.toggle('collapsed');
    }

    /* ===== Ù…ÙˆÙ„Ù‘Ø¯ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ ===== */
    function generatePrices(startPrice, months, trend) {
        const prices = [startPrice];
        let current  = startPrice;

        const scenarios = {
            bull_steady:    { drift: +0.025, vol: 0.02 },
            bull_volatile:  { drift: +0.020, vol: 0.07 },
            bear_steady:    { drift: -0.025, vol: 0.02 },
            bear_volatile:  { drift: -0.018, vol: 0.08 },
            sideways:       { drift:  0.000, vol: 0.05 },
            crash_recovery: null   /* Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ© */
        };

        if (trend === 'crash_recovery') {
            /* Ø§Ù„Ù†ØµÙ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù†Ù‡ÙŠØ§Ø±ØŒ Ø§Ù„Ù†ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ: ØªØ¹Ø§ÙÙŠ */
            const half = Math.floor(months / 2);
            for (let i = 1; i <= months; i++) {
                const noise = (Math.random() - 0.5) * 0.06;
                if (i <= half) current *= (1 - 0.04 + noise);
                else           current *= (1 + 0.045 + noise);
                prices.push(Math.max(current, startPrice * 0.2));
            }
        } else {
            const { drift, vol } = scenarios[trend];
            for (let i = 1; i <= months; i++) {
                const shock = (Math.random() - 0.5) * 2 * vol;
                current *= (1 + drift + shock);
                prices.push(Math.max(current, startPrice * 0.05));
            }
        }
        return prices;
    }

    /* ===== Ø­Ø³Ø§Ø¨ DCA ===== */
    function calcDCA(totalAmount, months, prices) {
        const monthlyInvest = totalAmount / months;
        let totalShares = 0;
        let totalSpent  = 0;
        const rows = [];

        for (let i = 0; i < months; i++) {
            const price   = prices[i + 1]; /* Ø§Ù„Ø³Ø¹Ø± Ø¹Ù†Ø¯ Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¯ÙØ¹Ø© i */
            const shares  = monthlyInvest / price;
            totalShares  += shares;
            totalSpent   += monthlyInvest;
            rows.push({
                month:      i + 1,
                price:      price,
                invested:   monthlyInvest,
                newShares:  shares,
                totalShares,
                avgCost:    totalSpent / totalShares
            });
        }
        return { avgCost: totalAmount / totalShares, totalShares, rows };
    }

    /* ===== Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ===== */
    let priceChart = null;
    let valueChart = null;

    function calculate() {
        /* ---- Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ---- */
        const totalAmount  = parseFloat(document.getElementById('totalAmount').value);
        const dcaMonths    = parseInt(document.getElementById('dcaMonths').value);
        const currentPrice = parseFloat(document.getElementById('currentPrice').value);
        const marketTrend  = document.getElementById('marketTrend').value;
        const annualGrowth = parseFloat(document.getElementById('annualGrowth').value);
        const holdYears    = parseInt(document.getElementById('holdYears').value);

        /* ---- Ø§Ù„ØªØ­Ù‚Ù‚ ---- */
        if (!totalAmount || !dcaMonths || !currentPrice || !marketTrend
            || isNaN(annualGrowth) || !holdYears) {
            alert('âš ï¸ Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨.');
            return;
        }
        if (dcaMonths < 2 || dcaMonths > 60) {
            alert('âš ï¸ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 2 Ùˆ 60.');
            return;
        }

        /* ---- ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ---- */
        const prices = generatePrices(currentPrice, dcaMonths, marketTrend);

        /* ---- DCA ---- */
        const dca = calcDCA(totalAmount, dcaMonths, prices);

        /* ---- Lump Sum ---- */
        const lumpShares   = totalAmount / currentPrice;
        const lumpAvgCost  = currentPrice;

        /* ---- Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ù†Ù‡Ø§ÙŠØ© ÙØªØ±Ø© DCA (Ø¢Ø®Ø± Ø³Ø¹Ø± Ù…Ø­Ø§ÙƒÙ‰) ---- */
        const priceAtDCAEnd = prices[prices.length - 1];

        /* ---- Ù†Ù…Ùˆ Ù…Ø§ Ø¨Ø¹Ø¯ DCA ---- */
        const growthFactor  = Math.pow(1 + annualGrowth / 100, holdYears);
        const finalPrice    = priceAtDCAEnd * growthFactor;

        const dcaFinalValue  = dca.totalShares  * finalPrice;
        const lumpFinalValue = lumpShares * finalPrice;

        const dcaProfit  = dcaFinalValue  - totalAmount;
        const lumpProfit = lumpFinalValue - totalAmount;

        /* ---- Ø§Ù„Ø­ÙƒÙ… ---- */
        const diff       = dcaFinalValue - lumpFinalValue;
        const diffPct    = Math.abs(diff / lumpFinalValue * 100).toFixed(1);
        const isTie      = Math.abs(diff / lumpFinalValue) < 0.01; /* ÙØ±Ù‚ < 1% = ØªØ¹Ø§Ø¯Ù„ */

        /* ---- Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ---- */
        document.getElementById('resultsSection').style.display = 'block';
        document.getElementById('resultsSection')
                .scrollIntoView({ behavior: 'smooth', block: 'start' });

        /* Ø§Ù„Ø­ÙƒÙ… */
        const verdict     = document.getElementById('verdictCard');
        const verdictTitle = document.getElementById('verdictTitle');
        const verdictText  = document.getElementById('verdictText');

        if (isTie) {
            verdict.className     = 'verdict-card verdict-tie';
            verdictTitle.textContent = 'âš–ï¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…ØªÙ‚Ø§Ø±Ø¨Ø© Ø¬Ø¯Ø§Ù‹';
            verdictText.textContent  =
                'Ø§Ù„ÙØ±Ù‚ Ø£Ù‚Ù„ Ù…Ù† 1% â€” Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØªØ§Ù† Ù…ØªÙƒØ§ÙØ¦ØªØ§Ù† ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ. '
              + 'Ø§Ø®ØªØ± DCA Ù„Ø±Ø§Ø­Ø© Ù†ÙØ³ÙŠØ© Ø£ÙƒØ¨Ø±.';
        } else if (diff > 0) {
            verdict.className     = 'verdict-card verdict-dca';
            verdictTitle.textContent = `âœ… DCA Ø£ÙØ¶Ù„ Ø¨Ù€ ${diffPct}%`;
            verdictText.textContent  =
                'ØªÙ†ÙˆÙŠØ¹ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø­Ù…Ù‰ Ù…Ø­ÙØ¸ØªÙƒ Ù…Ù† Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø³Ø¹Ø± Ù…Ø±ØªÙØ¹ '
              + 'ÙˆØ®ÙÙ‘Ø¶ Ù…ØªÙˆØ³Ø· ØªÙƒÙ„ÙØªÙƒ Ø§Ù„ÙØ¹Ù„ÙŠØ©.';
        } else {
            verdict.className     = 'verdict-card verdict-lump';
            verdictTitle.textContent = `âš¡ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„ÙÙˆØ±ÙŠ Ø£ÙØ¶Ù„ Ø¨Ù€ ${diffPct}%`;
            verdictText.textContent  =
                'ÙÙŠ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„ØµØ§Ø¹Ø¯Ø© Ø¨Ø«Ø¨Ø§ØªØŒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¨ÙƒØ± Ø§Ù„ÙƒØ§Ù…Ù„ ÙŠÙ…Ù†Ø­Ùƒ '
              + 'ÙˆÙ‚ØªØ§Ù‹ Ø£Ø·ÙˆÙ„ ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚ ÙˆÙŠØ¹Ø¸Ù‘Ù… Ø§Ù„ÙƒØ³Ø¨.';
        }

        /* Ø§Ù„Ø£Ø±Ù‚Ø§Ù… */
        const fmt = n => Number(n.toFixed(2)).toLocaleString('ar-SA');

        document.getElementById('dcaAvgCost').textContent   = fmt(dca.avgCost);
        document.getElementById('dcaShares').textContent    = `${fmt(dca.totalShares)} Ø³Ù‡Ù…`;
        document.getElementById('lumpAvgCost').textContent  = fmt(lumpAvgCost);
        document.getElementById('lumpShares').textContent   = `${fmt(lumpShares)} Ø³Ù‡Ù…`;
        document.getElementById('dcaFinalValue').textContent  = fmt(dcaFinalValue);
        document.getElementById('dcaProfit').textContent    =
            `Ø±Ø¨Ø­: ${fmt(dcaProfit)} (${(dcaProfit/totalAmount*100).toFixed(1)}%)`;
        document.getElementById('lumpFinalValue').textContent = fmt(lumpFinalValue);
        document.getElementById('lumpProfit').textContent   =
            `Ø±Ø¨Ø­: ${fmt(lumpProfit)} (${(lumpProfit/totalAmount*100).toFixed(1)}%)`;

        /* Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
        const details = [
            ['Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±',           fmt(totalAmount),          fmt(totalAmount)],
            ['Ø³Ø¹Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ©', fmt(dca.avgCost),          fmt(lumpAvgCost)],
            ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©',    fmt(dca.totalShares),      fmt(lumpShares)],
            ['Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ø¨Ø¹Ø¯ ' + holdYears + ' Ø³Ù†Ø©', fmt(finalPrice), fmt(finalPrice)],
            ['Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©',           fmt(dcaFinalValue),         fmt(lumpFinalValue)],
            ['Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ',              fmt(dcaProfit),             fmt(lumpProfit)],
        ];
        document.getElementById('detailRows').innerHTML = details.map(([label, d, l]) => `
            <div class="detail-row">
                <span class="detail-label">${label}</span>
                <span class="detail-dca">DCA: ${d}</span>
                <span class="detail-lump">ÙÙˆØ±ÙŠ: ${l}</span>
            </div>
        `).join('');

        /* Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø¹Ø§Ø± */
        const labels = ['Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©', ...Array.from({length: dcaMonths}, (_, i) => `Ø´${i+1}`)];
        drawChart('priceChart', priceChart, labels, prices, 'Ø³Ø¹Ø± Ø§Ù„Ø³Ù‡Ù…', '#2a5298',
                  c => { priceChart = c; });

        /* Ø±Ø³Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…Ø© */
        const valueData = dca.rows.map(r => +(r.totalShares * r.price).toFixed(2));
        const costData  = dca.rows.map((_, i) => +((i+1) * (totalAmount/dcaMonths)).toFixed(2));
        drawDualChart(labels.slice(1), valueData, costData);

        /* Ø¬Ø¯ÙˆÙ„ DCA */
        document.getElementById('dcaTableBody').innerHTML = dca.rows.map(r => `
            <tr>
                <td>${r.month}</td>
                <td>${fmt(r.price)}</td>
                <td>${fmt(r.invested)}</td>
                <td>${fmt(r.newShares)}</td>
                <td>${fmt(r.totalShares)}</td>
                <td>${fmt(r.avgCost)}</td>
            </tr>
        `).join('');
    }

    /* ===== Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ø¨Ø®Ø· ÙˆØ§Ø­Ø¯ ===== */
    function drawChart(canvasId, existingChart, labels, data, label, color, setter) {
        if (existingChart) existingChart.destroy();
        const ctx = document.getElementById(canvasId).getContext('2d');
        setter(new Chart(ctx, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    label, data,
                    borderColor: color,
                    backgroundColor: color + '22',
                    fill: true, tension: 0.35, pointRadius: 3
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: false }
                }
            }
        }));
    }

    /* ===== Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù…Ø²Ø¯ÙˆØ¬ (Ù‚ÙŠÙ…Ø© + ØªÙƒÙ„ÙØ©) ===== */
    function drawDualChart(labels, valueData, costData) {
        if (valueChart) valueChart.destroy();
        const ctx = document.getElementById('valueChart').getContext('2d');
        valueChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels,
                datasets: [
                    {
                        label: 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©',
                        data: valueData,
                        borderColor: '#27ae60',
                        backgroundColor: '#27ae6022',
                        fill: true, tension: 0.35, pointRadius: 3
                    },
                    {
                        label: 'Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©',
                        data: costData,
                        borderColor: '#e74c3c',
                        borderDash: [6, 3],
                        backgroundColor: 'transparent',
                        fill: false, tension: 0.1, pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: true, position: 'top' } },
                scales: { y: { beginAtZero: false } }
            }
        });
    }

    /* ===== Reset ===== */
    function resetAll() {
        if (!confirm('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
        ['totalAmount','dcaMonths','currentPrice','annualGrowth','holdYears']
            .forEach(id => document.getElementById(id).value = '');
        document.getElementById('marketTrend').value = '';
        document.getElementById('resultsSection').style.display = 'none';
        if (priceChart) { priceChart.destroy(); priceChart = null; }
        if (valueChart) { valueChart.destroy(); valueChart = null; }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
</script>
</body>
</html>
