<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙƒØ³ÙŠ | Ù…ÙÙƒØ±Ø© Ù…Ø³ØªØ«Ù…Ø±</title>
    <link rel="stylesheet" href="navigation.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh; padding: 20px; color: #2c3e50;
        }

        .navbar-wrapper { max-width: 900px; margin: 0 auto 15px; }

        .container {
            max-width: 900px; margin: 0 auto;
            background: white; border-radius: 20px;
            padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        /* ===== Legal Banner ===== */
        .legal-banner {
            background: #fff3cd; border: 2px solid #ffc107;
            border-radius: 8px; padding: 11px 15px;
            margin-bottom: 25px;
            display: flex; align-items: flex-start; gap: 10px;
        }
        .legal-banner p {
            color: #856404; font-size: 0.83rem;
            font-weight: bold; line-height: 1.5; flex: 1;
        }

        /* ===== Header ===== */
        h1 {
            text-align: center; color: #0f3460;
            font-size: 2rem; margin-bottom: 6px;
        }
        .subtitle {
            text-align: center; color: #7f8c8d;
            margin-bottom: 30px; font-size: 0.92rem;
        }

        /* ===== Sections ===== */
        .rule-item {
            background: #f8f9fa; border-radius: 15px;
            padding: 25px; margin: 20px 0;
            border-right: 5px solid #0f3460;
        }
        .rule-item h3 {
            color: #0f3460; margin-bottom: 18px;
            font-size: 1rem; border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }

        /* ===== Input Grid ===== */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 18px;
        }
        .input-group { display: flex; flex-direction: column; }
        .input-group label {
            font-weight: bold; font-size: 0.85rem;
            color: #34495e; margin-bottom: 7px;
        }
        .input-group input, .input-group select {
            padding: 11px; border: 2px solid #e0e0e0;
            border-radius: 8px; font-size: 0.95rem;
            transition: border-color 0.3s; background: white;
        }
        .input-group input:focus,
        .input-group select:focus {
            border-color: #0f3460; outline: none; background: #f0f4ff;
        }
        .input-hint {
            font-size: 0.75rem; color: #95a5a6; margin-top: 4px;
        }

        /* ===== Mode Switcher ===== */
        .mode-switcher {
            display: flex; gap: 10px; margin-bottom: 25px;
            background: #f0f4ff; border-radius: 12px; padding: 6px;
        }
        .mode-btn {
            flex: 1; padding: 12px; border: none;
            border-radius: 9px; cursor: pointer;
            font-size: 0.9rem; font-weight: bold;
            transition: all 0.3s; color: #666; background: transparent;
        }
        .mode-btn.active {
            background: #0f3460; color: white;
            box-shadow: 0 4px 12px rgba(15,52,96,0.3);
        }

        /* ===== Calculate Button ===== */
        .calc-btn {
            display: block; width: 100%; padding: 16px;
            background: linear-gradient(135deg, #0f3460, #16213e);
            color: white; border: none; border-radius: 12px;
            font-size: 1.1rem; font-weight: bold;
            cursor: pointer; margin: 25px 0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(15,52,96,0.4);
        }

        /* ===== Results ===== */
        .results-section { display: none; }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .main-result {
            background: linear-gradient(135deg, #0f3460, #533483);
            color: white; border-radius: 18px;
            padding: 35px; text-align: center; margin-bottom: 20px;
        }
        .main-result .label {
            font-size: 1rem; opacity: 0.85; margin-bottom: 10px;
        }
        .main-result .big-number {
            font-size: 3.5rem; font-weight: bold;
            color: #f1c40f; line-height: 1; margin-bottom: 8px;
        }
        .main-result .sub-label {
            font-size: 0.88rem; opacity: 0.75;
        }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù„Ø®Øµ */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px; margin-bottom: 20px;
        }
        .summary-card {
            background: #f8f9fa; border-radius: 12px;
            padding: 16px; text-align: center;
            border-top: 3px solid #0f3460;
        }
        .summary-card .s-label {
            font-size: 0.78rem; color: #7f8c8d; margin-bottom: 6px;
        }
        .summary-card .s-value {
            font-size: 1.2rem; font-weight: bold; color: #0f3460;
        }
        .summary-card.highlight { border-top-color: #27ae60; }
        .summary-card.highlight .s-value { color: #27ae60; }
        .summary-card.warn { border-top-color: #e74c3c; }
        .summary-card.warn .s-value { color: #e74c3c; }

        /* ===== Scenarios ===== */
        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
            gap: 12px; margin-top: 5px;
        }
        .scenario-card {
            border-radius: 10px; padding: 14px; text-align: center;
            border: 2px solid #e0e0e0;
        }
        .scenario-card .sc-rate {
            font-size: 1rem; font-weight: bold; margin-bottom: 6px;
        }
        .scenario-card .sc-amount {
            font-size: 1.3rem; font-weight: bold; color: #0f3460;
        }
        .scenario-card .sc-label {
            font-size: 0.75rem; color: #7f8c8d; margin-top: 4px;
        }
        .scenario-card.conservative { border-color: #e74c3c; background: #fdf0f0; }
        .scenario-card.conservative .sc-rate { color: #e74c3c; }
        .scenario-card.moderate     { border-color: #f39c12; background: #fef9f0; }
        .scenario-card.moderate .sc-rate { color: #f39c12; }
        .scenario-card.optimistic   { border-color: #27ae60; background: #f0fdf4; }
        .scenario-card.optimistic .sc-rate { color: #27ae60; }
        .scenario-card.aggressive   { border-color: #8e44ad; background: #f9f0ff; }
        .scenario-card.aggressive .sc-rate { color: #8e44ad; }

        /* ===== Timeline Chart ===== */
        .chart-wrapper {
            background: #f8f9fa; border-radius: 12px;
            padding: 20px; margin-top: 20px;
        }
        .chart-wrapper h4 {
            color: #0f3460; margin-bottom: 15px; font-size: 0.95rem;
        }
        .chart-container { position: relative; height: 280px; }

        /* ===== Milestone Table ===== */
        .milestone-table {
            width: 100%; border-collapse: collapse;
            font-size: 0.85rem; margin-top: 5px;
        }
        .milestone-table th {
            background: #0f3460; color: white;
            padding: 10px; text-align: center;
        }
        .milestone-table td {
            padding: 9px 10px; text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }
        .milestone-table tr:hover { background: #f0f4ff; }
        .milestone-table .goal-row {
            background: #fffde7 !important;
            font-weight: bold; color: #0f3460;
        }

        /* ===== Insight Box ===== */
        .insight-box {
            background: linear-gradient(135deg, #e8f5e9, #f0fdf4);
            border: 2px solid #27ae60; border-radius: 12px;
            padding: 18px; margin-top: 20px;
        }
        .insight-box h4 { color: #1e8449; margin-bottom: 10px; font-size: 0.95rem; }
        .insight-box p  { color: #2c3e50; font-size: 0.88rem; line-height: 1.7; margin: 6px 0; }

        /* ===== Reset ===== */
        .reset-btn {
            display: block; margin: 20px auto 0;
            padding: 11px 28px; background: #95a5a6;
            color: white; border: none; border-radius: 10px;
            cursor: pointer; font-size: 0.95rem;
            transition: background 0.3s;
        }
        .reset-btn:hover { background: #7f8c8d; }

        /* ===== Responsive ===== */
        @media (max-width: 768px) {
            .container { padding: 20px; }
            h1 { font-size: 1.6rem; }
            .main-result .big-number { font-size: 2.5rem; }
            .mode-btn { font-size: 0.8rem; padding: 10px 6px; }
        }
        @media (max-width: 480px) {
            body { padding: 10px; }
            .summary-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

<div class="navbar-wrapper">
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">ğŸ“ˆ Ù…ÙÙƒØ±Ø© Ù…Ø³ØªØ«Ù…Ø±</a>
            <button class="navbar-toggle" onclick="toggleNavbar()">â˜°</button>
            <div class="navbar-menu" id="navbarMenu">
                <a href="index.html"                     class="navbar-item">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="advice.html"                    class="navbar-item calculator">ğŸ’° ØµØ§ÙÙŠ Ø§Ù„Ø«Ø±ÙˆØ©</a>
                <a href="salary_calculator.html"         class="navbar-item salary">ğŸ’¼ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø±Ø§ØªØ¨</a>
                <a href="zakat_purification.html"        class="navbar-item zakat">ğŸ•Œ Ø§Ù„Ø²ÙƒØ§Ø©</a>
                <a href="financial_freedom.html"         class="navbar-item fire">ğŸ”¥ Ø§Ù„Ø­Ø±ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</a>
                <a href="investor_tips.html"             class="navbar-item tips">âš ï¸ Ù†ØµØ§Ø¦Ø­</a>
                <a href="snowball_calculator.html"       class="navbar-item calculator">â„ï¸ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨</a>
                <a href="emergency_fund_calculator.html" class="navbar-item emergency">ğŸ›¡ï¸ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</a>
                <a href="average_calculator.html"        class="navbar-item average">ğŸ“Š Ù…ØªÙˆØ³Ø· Ø§Ù„Ø´Ø±Ø§Ø¡</a>
                <a href="company_valuation.html"         class="navbar-item company">ğŸ¢ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø±ÙƒØ©</a>
                <a href="retirement_calculator.html"     class="navbar-item retirement">ğŸ–ï¸ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</a>
                <a href="portfolio_rating.html"          class="navbar-item portfolio">ğŸ›¡ï¸ Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
                <a href="stock_valuation.html"           class="navbar-item calculator">ğŸ“Š ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø³Ù‡Ù…</a>
                <a href="dca_calculator.html"            class="navbar-item calculator">ğŸ“… DCA</a>
                <a href="goal_calculator.html"           class="navbar-item calculator active">ğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¹ÙƒØ³ÙŠ</a>
            </div>
        </div>
    </nav>
</div>

<div class="container">

    <div class="legal-banner">
        <span>âš ï¸</span>
        <p>Ø¥Ù‚Ø±Ø§Ø± Ù‚Ø§Ù†ÙˆÙ†ÙŠ: Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ØªÙ‚Ø¯ÙŠØ±ÙŠØ©. Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø§ÙØªØ±Ø§Ø¶Ø§Øª Ø±ÙŠØ§Ø¶ÙŠØ© Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ø§ ØªØ¶Ù…Ù† Ø¹ÙˆØ§Ø¦Ø¯ ÙØ¹Ù„ÙŠØ©. Ù‚Ø±Ø§Ø± Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± ÙŠÙ‚Ø¹ Ø¹Ù„Ù‰ Ø¹Ø§ØªÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ­Ø¯Ù‡.</p>
    </div>

    <h1>ğŸ¯ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙƒØ³ÙŠ</h1>
    <p class="subtitle">Ø£Ø¯Ø®Ù„ Ù‡Ø¯ÙÙƒ â€” Ù†Ø­Ø³Ø¨ Ù„Ùƒ ÙƒÙ… ØªØ­ØªØ§Ø¬ ØªØ¯Ù‘Ø®Ø± ÙƒÙ„ Ø´Ù‡Ø±</p>

    <!-- Mode Switcher -->
    <div class="mode-switcher">
        <button class="mode-btn active" id="btn-monthly"
                onclick="switchMode('monthly')">
            ğŸ“… ÙƒÙ… Ø£Ø¯Ù‘Ø®Ø± Ø´Ù‡Ø±ÙŠØ§Ù‹ØŸ
        </button>
        <button class="mode-btn" id="btn-years"
                onclick="switchMode('years')">
            â³ ÙƒÙ… Ø³Ù†Ø© Ø£Ø­ØªØ§Ø¬ØŸ
        </button>
        <button class="mode-btn" id="btn-rate"
                onclick="switchMode('rate')">
            ğŸ“ˆ Ø£ÙŠ Ø¹Ø§Ø¦Ø¯ Ø£Ø­ØªØ§Ø¬ØŸ
        </button>
    </div>

    <!-- ===== Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ===== -->
    <div class="rule-item">
        <h3 id="inputTitle">ğŸ¯ Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø¯ÙÙƒ</h3>
        <div class="input-grid" id="inputGrid">

            <div class="input-group">
                <label>ğŸ† Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
                <input type="number" id="goalAmount"
                       placeholder="Ù…Ø«Ø§Ù„: 1000000" min="1">
                <span class="input-hint">Ø¨Ø£ÙŠ Ø¹Ù…Ù„Ø© ØªØ±ÙŠØ¯</span>
            </div>

            <div class="input-group" id="field-savings">
                <label>ğŸ’° Ø§Ù„Ù…Ø¯Ù‘Ø®Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input type="number" id="currentSavings"
                       placeholder="0" min="0">
                <span class="input-hint">Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
            </div>

            <!-- ÙŠØ¸Ù‡Ø±/ÙŠØ®ØªÙÙŠ Ø­Ø³Ø¨ Ø§Ù„ÙˆØ¶Ø¹ -->
            <div class="input-group" id="field-monthly">
                <label>ğŸ“… Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ø°ÙŠ ØªØ³ØªØ·ÙŠØ¹ ØªÙˆÙÙŠØ±Ù‡</label>
                <input type="number" id="monthlyAmount"
                       placeholder="Ù…Ø«Ø§Ù„: 2000" min="0">
                <span class="input-hint">ÙŠØ¸Ù‡Ø± ÙÙŠ ÙˆØ¶Ø¹ "ÙƒÙ… Ø³Ù†Ø©" Ùˆ"Ø£ÙŠ Ø¹Ø§Ø¦Ø¯"</span>
            </div>

            <div class="input-group" id="field-years">
                <label>ğŸ“† Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‡Ø¯Ù</label>
                <input type="number" id="targetYears"
                       placeholder="Ù…Ø«Ø§Ù„: 15" min="1" max="50">
                <span class="input-hint">ÙŠØ¸Ù‡Ø± ÙÙŠ ÙˆØ¶Ø¹ "ÙƒÙ… Ø£Ø¯Ù‘Ø®Ø±" Ùˆ"Ø£ÙŠ Ø¹Ø§Ø¦Ø¯"</span>
            </div>

            <div class="input-group" id="field-rate">
                <label>ğŸ“ˆ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (%)</label>
                <input type="number" id="annualRate"
                       placeholder="Ù…Ø«Ø§Ù„: 8" step="0.1" min="0" max="50">
                <span class="input-hint">ÙŠØ¸Ù‡Ø± ÙÙŠ ÙˆØ¶Ø¹ "ÙƒÙ… Ø£Ø¯Ù‘Ø®Ø±" Ùˆ"ÙƒÙ… Ø³Ù†Ø©"</span>
            </div>

            <div class="input-group">
                <label>ğŸ“Š Ø§Ù„ØªØ¶Ø®Ù… Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (%)</label>
                <input type="number" id="inflationRate"
                       placeholder="Ù…Ø«Ø§Ù„: 3" step="0.1" min="0" max="20"
                       value="3">
                <span class="input-hint">ÙŠÙØ­Ø³Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¶Ø®Ù…</span>
            </div>

        </div>
    </div>

    <button class="calc-btn" onclick="calculate()">ğŸ¯ Ø§Ø­Ø³Ø¨ Ù‡Ø¯ÙÙŠ</button>

    <!-- ===== Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ===== -->
    <div class="results-section" id="resultsSection">

        <!-- Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="main-result">
            <div class="label" id="mainLabel">â€”</div>
            <div class="big-number" id="mainNumber">â€”</div>
            <div class="sub-label" id="mainSub">â€”</div>
        </div>

        <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… -->
        <div class="summary-grid" id="summaryGrid"></div>

        <!-- Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ø¯ -->
        <div class="rule-item">
            <h3>ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª (Ø¹ÙˆØ§Ø¦Ø¯ Ù…Ø®ØªÙ„ÙØ©)</h3>
            <div class="scenarios-grid" id="scenariosGrid"></div>
        </div>

        <!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ -->
        <div class="chart-wrapper">
            <h4>ğŸ“ˆ Ù†Ù…Ùˆ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù†</h4>
            <div class="chart-container">
                <canvas id="growthChart"></canvas>
            </div>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ -->
        <div class="rule-item">
            <h3>ğŸ—“ï¸ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø¹Ø§Ù„Ù…</h3>
            <div style="overflow-x:auto;">
                <table class="milestone-table" id="milestoneTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø³Ù†Ø©</th>
                            <th>Ø§Ù„Ù…Ø¯Ù‘Ø®Ø± Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ</th>
                            <th>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…</th>
                            <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©</th>
                            <th>% Ù…Ù† Ø§Ù„Ù‡Ø¯Ù</th>
                        </tr>
                    </thead>
                    <tbody id="milestoneBody"></tbody>
                </table>
            </div>
        </div>

        <!-- ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ -->
        <div class="insight-box" id="insightBox">
            <h4>ğŸ’¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ù</h4>
            <p id="insightText">â€”</p>
        </div>

        <button class="reset-btn" onclick="resetAll()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
    </div>

</div>

<script>
    /* ===== Navbar ===== */
    function toggleNavbar() {
        document.getElementById('navbarMenu').classList.toggle('open');
    }
    document.addEventListener('DOMContentLoaded', function () {
        const raw  = window.location.pathname.split('/').pop() || 'index.html';
        const page = raw.split('?')[0].split('#')[0] || 'index.html';
        document.querySelectorAll('.navbar-item').forEach(function (item) {
            item.classList.remove('active');
            const href = (item.getAttribute('href') || '').split('?')[0].split('#')[0];
            if (href === page) item.classList.add('active');
        });
    });

    /* ===== Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ ===== */
    let currentMode = 'monthly'; /* monthly | years | rate */
    let growthChart = null;

    function switchMode(mode) {
        currentMode = mode;
        ['monthly','years','rate'].forEach(m => {
            document.getElementById('btn-' + m).classList.toggle('active', m === mode);
        });

        /* Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„ÙˆØ¶Ø¹ */
        /* monthly: Ù†Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙØ¹Ø© â†’ Ù†Ø­ØªØ§Ø¬ years + rate */
        /* years:   Ù†Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯Ø©  â†’ Ù†Ø­ØªØ§Ø¬ monthly + rate */
        /* rate:    Ù†Ø­Ø³Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ø¯ â†’ Ù†Ø­ØªØ§Ø¬ monthly + years */
        const show = {
            monthly: { monthly: false, years: true,  rate: true  },
            years:   { monthly: true,  years: false, rate: true  },
            rate:    { monthly: true,  years: true,  rate: false }
        };
        const titles = {
            monthly: 'ğŸ“… ÙƒÙ… Ø£Ø¯Ù‘Ø®Ø± Ø´Ù‡Ø±ÙŠØ§Ù‹ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø¯ÙÙƒØŸ',
            years:   'â³ ÙƒÙ… Ø³Ù†Ø© ØªØ­ØªØ§Ø¬ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø¯ÙÙƒØŸ',
            rate:    'ğŸ“ˆ Ø£ÙŠ Ø¹Ø§Ø¦Ø¯ ØªØ­ØªØ§Ø¬ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø¯ÙÙƒØŸ'
        };
        document.getElementById('inputTitle').textContent = titles[mode];

        Object.entries(show[mode]).forEach(([field, visible]) => {
            const el = document.getElementById('field-' + field);
            if (el) el.style.display = visible ? '' : 'none';
        });

        document.getElementById('resultsSection').style.display = 'none';
    }

    /* ===== ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ===== */
    const fmt  = n => Number(n.toFixed(0)).toLocaleString('ar-SA');
    const fmt2 = n => Number(n.toFixed(2)).toLocaleString('ar-SA');

    /* ===== Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ===== */
    function calculate() {
        const goal     = parseFloat(document.getElementById('goalAmount').value)    || 0;
        const current  = parseFloat(document.getElementById('currentSavings').value) || 0;
        const monthly  = parseFloat(document.getElementById('monthlyAmount').value) || 0;
        const years    = parseFloat(document.getElementById('targetYears').value)   || 0;
        const rate     = parseFloat(document.getElementById('annualRate').value)    || 0;
        const inflation= parseFloat(document.getElementById('inflationRate').value) || 0;

        if (!goal) { alert('âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù…Ø§Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹.'); return; }

        let result, mainLabel, mainSub;
        const realRate = rate - inflation; /* Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¶Ø®Ù… */

        /* Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ */
        const r = rate / 100 / 12;

        if (currentMode === 'monthly') {
            if (!years || !rate) { alert('âš ï¸ Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª ÙˆØ§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ.'); return; }
            const n = years * 12;
            /* PMT = (FV - PV*(1+r)^n) * r / ((1+r)^n - 1) */
            const fv  = goal;
            const pv  = current;
            const factor = Math.pow(1 + r, n);
            result = r > 0
                ? (fv - pv * factor) * r / (factor - 1)
                : (fv - pv) / n;
            result = Math.max(0, result);
            mainLabel = 'ØªØ­ØªØ§Ø¬ Ø£Ù† ØªØ¯Ù‘Ø®Ø± Ø´Ù‡Ø±ÙŠØ§Ù‹';
            mainSub   = `Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ${fmt(goal)} Ø®Ù„Ø§Ù„ ${years} Ø³Ù†Ø© Ø¨Ø¹Ø§Ø¦Ø¯ ${rate}%`;

        } else if (currentMode === 'years') {
            if (!monthly || !rate) { alert('âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø´Ù‡Ø±ÙŠ ÙˆØ§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ.'); return; }
            /* Ø­Ù„ ØªÙƒØ±Ø§Ø±ÙŠ Ù„Ø¥ÙŠØ¬Ø§Ø¯ n */
            let n = 1, pv = current;
            while (n <= 600) {
                const fv = r > 0
                    ? pv * Math.pow(1+r,n) + monthly * (Math.pow(1+r,n)-1) / r
                    : pv + monthly * n;
                if (fv >= goal) break;
                n++;
            }
            result    = n / 12;
            mainLabel = 'ØªØ­ØªØ§Ø¬ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹';
            mainSub   = `Ù„ØªØµÙ„ Ø¥Ù„Ù‰ ${fmt(goal)} Ø¨Ø§Ø¯Ù‘Ø®Ø§Ø± ${fmt(monthly)} Ø´Ù‡Ø±ÙŠØ§Ù‹ Ø¨Ø¹Ø§Ø¦Ø¯ ${rate}%`;

        } else { /* rate */
            if (!monthly || !years) { alert('âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø´Ù‡Ø±ÙŠ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª.'); return; }
            const n = years * 12;
            /* Ø­Ù„ ØªÙƒØ±Ø§Ø±ÙŠ Ù„Ø¥ÙŠØ¬Ø§Ø¯ r */
            let lo = 0, hi = 1, mid, fv;
            for (let i = 0; i < 100; i++) {
                mid = (lo + hi) / 2;
                fv  = mid > 0
                    ? current * Math.pow(1+mid,n) + monthly * (Math.pow(1+mid,n)-1) / mid
                    : current + monthly * n;
                if (fv < goal) lo = mid;
                else           hi = mid;
            }
            result    = mid * 12 * 100;
            mainLabel = 'ØªØ­ØªØ§Ø¬ Ø¹Ø§Ø¦Ø¯Ø§Ù‹ Ø³Ù†ÙˆÙŠØ§Ù‹ Ø¨Ù†Ø³Ø¨Ø©';
            mainSub   = `Ù„ØªØµÙ„ Ø¥Ù„Ù‰ ${fmt(goal)} Ø®Ù„Ø§Ù„ ${years} Ø³Ù†Ø© Ø¨Ø§Ø¯Ù‘Ø®Ø§Ø± ${fmt(monthly)} Ø´Ù‡Ø±ÙŠØ§Ù‹`;
        }

        /* ===== Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ===== */
        document.getElementById('resultsSection').style.display = 'block';
        document.getElementById('resultsSection')
                .scrollIntoView({ behavior: 'smooth', block: 'start' });

        document.getElementById('mainLabel').textContent = mainLabel;
        document.getElementById('mainSub').textContent   = mainSub;

        if (currentMode === 'monthly') {
            document.getElementById('mainNumber').textContent = fmt(result) + ' Ø´Ù‡Ø±ÙŠØ§Ù‹';
        } else if (currentMode === 'years') {
            document.getElementById('mainNumber').textContent =
                result.toFixed(1) + ' Ø³Ù†Ø©';
        } else {
            document.getElementById('mainNumber').textContent =
                result.toFixed(2) + '%';
        }

        /* ===== Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ===== */
        const usedMonthly = currentMode === 'monthly' ? result : monthly;
        const usedYears   = currentMode === 'years'   ? result : years;
        const usedRate    = currentMode === 'rate'    ? result : rate;
        const usedR       = usedRate / 100 / 12;
        const usedN       = Math.round(usedYears * 12);

        const totalSaved  = usedMonthly * usedN + current;
        const finalFV     = usedR > 0
            ? current * Math.pow(1+usedR, usedN) + usedMonthly * (Math.pow(1+usedR,usedN)-1) / usedR
            : current + usedMonthly * usedN;
        const totalReturn = finalFV - totalSaved;
        const returnPct   = totalSaved > 0 ? (totalReturn / totalSaved * 100) : 0;

        document.getElementById('summaryGrid').innerHTML = `
            <div class="summary-card">
                <div class="s-label">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù…Ø§Ù„ÙŠ</div>
                <div class="s-value">${fmt(goal)}</div>
            </div>
            <div class="summary-card">
                <div class="s-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø§ Ø³ØªØ¯Ù‘Ø®Ø±Ù‡</div>
                <div class="s-value">${fmt(totalSaved)}</div>
            </div>
            <div class="summary-card highlight">
                <div class="s-label">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…</div>
                <div class="s-value">${fmt(totalReturn)}</div>
            </div>
            <div class="summary-card">
                <div class="s-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø¯Ù‘Ø®Ø§Ø±</div>
                <div class="s-value">${returnPct.toFixed(0)}%</div>
            </div>
            <div class="summary-card">
                <div class="s-label">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (Ø¨Ø¹Ø¯ ØªØ¶Ø®Ù… ${inflation}%)</div>
                <div class="s-value">${(usedRate - inflation).toFixed(1)}%</div>
            </div>
            <div class="summary-card ${usedRate - inflation < 3 ? 'warn' : 'highlight'}">
                <div class="s-label">Ù‚ÙŠÙ…Ø© Ù‡Ø¯ÙÙƒ Ø§Ù„ÙŠÙˆÙ…</div>
                <div class="s-value">${fmt(goal / Math.pow(1 + inflation/100, usedYears))}</div>
            </div>
        `;

        /* ===== Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ø¯ ===== */
        const scenarios = [
            { label: 'Ù…ØªØ­ÙØ¸',    rate: 4,  cls: 'conservative' },
            { label: 'Ù…Ø¹ØªØ¯Ù„',    rate: 7,  cls: 'moderate'     },
            { label: 'Ù…ØªÙØ§Ø¦Ù„',   rate: 10, cls: 'optimistic'   },
            { label: 'Ø¹Ø¯ÙˆØ§Ù†ÙŠ',   rate: 15, cls: 'aggressive'   },
        ];
        document.getElementById('scenariosGrid').innerHTML = scenarios.map(sc => {
            const sr     = sc.rate / 100 / 12;
            const sfv    = sr > 0
                ? current * Math.pow(1+sr, usedN) + usedMonthly * (Math.pow(1+sr,usedN)-1) / sr
                : current + usedMonthly * usedN;
            const pct    = (sfv / goal * 100).toFixed(0);
            return `
                <div class="scenario-card ${sc.cls}">
                    <div class="sc-rate">${sc.rate}% Ø³Ù†ÙˆÙŠØ§Ù‹</div>
                    <div class="sc-amount">${fmt(sfv)}</div>
                    <div class="sc-label">${pct}% Ù…Ù† Ù‡Ø¯ÙÙƒ â€” ${sc.label}</div>
                </div>
            `;
        }).join('');

        /* ===== Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ===== */
        const chartLabels  = [];
        const chartSaved   = [];
        const chartPortfolio = [];
        let   cumSaved = current, cumFV = current;

        for (let y = 0; y <= Math.ceil(usedYears); y++) {
            chartLabels.push('Ø³' + y);
            chartSaved.push(+(current + usedMonthly * y * 12).toFixed(0));
            const n2 = y * 12;
            const fv2 = usedR > 0
                ? current * Math.pow(1+usedR,n2) + usedMonthly*(Math.pow(1+usedR,n2)-1)/usedR
                : current + usedMonthly * n2;
            chartPortfolio.push(+fv2.toFixed(0));
        }

        if (growthChart) { growthChart.destroy(); growthChart = null; }
        const ctx = document.getElementById('growthChart').getContext('2d');
        growthChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartLabels,
                datasets: [
                    {
                        label: 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©',
                        data: chartPortfolio,
                        borderColor: '#0f3460',
                        backgroundColor: 'rgba(15,52,96,0.1)',
                        fill: true, tension: 0.4, pointRadius: 3
                    },
                    {
                        label: 'Ø§Ù„Ù…Ø¯Ù‘Ø®Ø± Ø§Ù„ÙØ¹Ù„ÙŠ',
                        data: chartSaved,
                        borderColor: '#e74c3c',
                        borderDash: [6,3],
                        backgroundColor: 'transparent',
                        fill: false, tension: 0.1, pointRadius: 0
                    },
                    {
                        label: 'Ø§Ù„Ù‡Ø¯Ù',
                        data: Array(chartLabels.length).fill(goal),
                        borderColor: '#27ae60',
                        borderDash: [4,4],
                        backgroundColor: 'transparent',
                        fill: false, pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: true, position: 'top' } },
                scales: { y: { beginAtZero: false } }
            }
        });

        /* ===== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ ===== */
        const milestones = [1,2,3,5,7,10,15,20,25,30]
            .filter(y => y <= Math.ceil(usedYears) + 2);
        const goalYear = Math.ceil(usedYears);

        document.getElementById('milestoneBody').innerHTML = milestones.map(y => {
            const n3   = y * 12;
            const fv3  = usedR > 0
                ? current * Math.pow(1+usedR,n3) + usedMonthly*(Math.pow(1+usedR,n3)-1)/usedR
                : current + usedMonthly * n3;
            const saved3  = current + usedMonthly * n3;
            const return3 = fv3 - saved3;
            const pct3    = (fv3 / goal * 100).toFixed(0);
            const isGoal  = y === goalYear;
            return `
                <tr class="${isGoal ? 'goal-row' : ''}">
                    <td>${y} ${isGoal ? 'ğŸ¯' : ''}</td>
                    <td>${fmt(saved3)}</td>
                    <td>${fmt(return3)}</td>
                    <td>${fmt(fv3)}</td>
                    <td>${pct3}%</td>
                </tr>
            `;
        }).join('');

        /* ===== Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ ===== */
        const insights = [];
        const realR = usedRate - inflation;

        if (realR < 0) {
            insights.push(`âš ï¸ Ø¹Ø§Ø¦Ø¯Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø³Ø§Ù„Ø¨ (${realR.toFixed(1)}%) â€” Ø§Ù„ØªØ¶Ø®Ù… ÙŠØ£ÙƒÙ„ Ù…Ø¯Ù‘Ø®Ø±Ø§ØªÙƒ. ØªØ­ØªØ§Ø¬ Ø¹Ø§Ø¦Ø¯Ø§Ù‹ Ø£Ø¹Ù„Ù‰ Ù…Ù† ${inflation}% ÙÙ‚Ø· Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ø£Ù…ÙˆØ§Ù„Ùƒ.`);
        } else if (realR < 3) {
            insights.push(`âš ï¸ Ø¹Ø§Ø¦Ø¯Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù†Ø®ÙØ¶ (${realR.toFixed(1)}%) â€” Ø¶Ø¹ ÙÙŠ Ø§Ø¹ØªØ¨Ø§Ø±Ùƒ Ø£Ø¯ÙˆØ§Øª Ø§Ø³ØªØ«Ù…Ø§Ø± Ø¨Ø¹Ø§Ø¦Ø¯ Ø£Ø¹Ù„Ù‰.`);
        } else {
            insights.push(`âœ… Ø¹Ø§Ø¦Ø¯Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø¬ÙŠØ¯ (${realR.toFixed(1)}%) â€” Ø£Ù…ÙˆØ§Ù„Ùƒ ØªÙ†Ù…Ùˆ ÙØ¹Ù„Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ØªØ¶Ø®Ù….`);
        }

        if (currentMode === 'monthly') {
            const pctOfGoal = usedMonthly / goal * 100;
            insights.push(`ğŸ“Š Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© ØªÙ…Ø«Ù„ ${pctOfGoal.toFixed(2)}% Ù…Ù† Ù‡Ø¯ÙÙƒ â€” ${pctOfGoal < 1 ? 'Ù…Ù…ØªØ§Ø²ØŒ Ø§Ù„Ù‡Ø¯Ù ÙƒØ¨ÙŠØ± ÙˆØ§Ù„Ù…Ø¯Ø© Ø·ÙˆÙŠÙ„Ø©' : 'Ø®Ø·Ø© Ù…Ø¹Ù‚ÙˆÙ„Ø©'}.`);
        }

        const compoundRatio = totalReturn / totalSaved * 100;
        if (compoundRatio > 100) {
            insights.push(`ğŸš€ Ø§Ù„Ù…Ø±ÙƒÙ‘Ø¨ ÙŠØ¹Ù…Ù„ Ù„ØµØ§Ù„Ø­Ùƒ â€” Ø§Ù„Ø¹Ø§Ø¦Ø¯ (${fmt(totalReturn)}) ÙŠØªØ¬Ø§ÙˆØ² Ù…Ø§ Ø§Ø¯Ù‘Ø®Ø±ØªÙ‡ Ø¨Ù†ÙØ³Ùƒ (${fmt(totalSaved)}). Ù‡Ø°Ø§ Ù‡Ùˆ Ø³Ø± Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø·ÙˆÙŠÙ„ Ø§Ù„Ø£Ù…Ø¯.`);
        }

        document.getElementById('insightText').innerHTML =
            insights.map(i => `<p>${i}</p>`).join('');
    }

    /* ===== Reset ===== */
    function resetAll() {
        if (!confirm('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
        ['goalAmount','currentSavings','monthlyAmount','targetYears','annualRate']
            .forEach(id => document.getElementById(id).value = '');
        document.getElementById('inflationRate').value = '3';
        document.getElementById('resultsSection').style.display = 'none';
        if (growthChart) { growthChart.destroy(); growthChart = null; }
        switchMode('monthly');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    /* ===== Init ===== */
    switchMode('monthly');
</script>
</body>
</html>
