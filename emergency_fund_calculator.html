<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ - Ù…ÙÙƒØ±Ø© Ù…Ø³ØªØ«Ù…Ø±</title>
    <link rel="stylesheet" href="navigation.css">
    <link rel="stylesheet" href="dark-theme.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Arial, sans-serif; background: linear-gradient(135deg, #e8f0f5 0%, #d0e0e8 100%); min-height: 100vh; padding: 20px; color: #2c3e50; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .calculator-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .section-title { font-size: 1.4rem; color: #2c3e50; margin-bottom: 25px; padding-bottom: 10px; border-bottom: 3px solid #5a7fb5; }
        .input-group, .select-group { margin-bottom: 20px; }
        .input-group label, .select-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #34495e; }
        .input-group input, .select-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; background: white; }
        .input-group input:focus, .select-group select:focus { outline: none; border-color: #5a7fb5; }
        .savings-group { margin-bottom: 20px; }
        .savings-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #5a9d7a; }
        .savings-group input { width: 100%; padding: 12px; border: 2px solid #5a9d7a; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; }
        .savings-group input:focus { outline: none; border-color: #3a7d5a; }
        .info-box { background: rgba(90,127,181,0.1); border: 2px solid #5a7fb5; border-radius: 10px; padding: 15px; margin-bottom: 20px; }
        .info-box h4 { color: #4a6fa5; margin-bottom: 10px; }
        .info-box p { color: #424242; line-height: 1.6; }
        .error-box { background: #fdecea; border: 2px solid #e74c3c; border-radius: 10px; padding: 15px; color: #c0392b; margin-bottom: 20px; display: none; font-weight: bold; }
        .calculate-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #5a7fb5, #4a6fa5); color: white; border: none; border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; margin-top: 10px; }
        .calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(90,127,181,0.3); }
        .result-card { color: white; padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(90,157,122,0.2); margin-bottom: 30px; }
        .result-card h2 { font-size: 1.2rem; margin-bottom: 15px; opacity: 0.9; }
        .result-amount { font-size: 3rem; font-weight: bold; margin-bottom: 10px; }
        .result-period { font-size: 1.1rem; opacity: 0.8; }
        .progress-section { background: white; border-radius: 20px; padding: 25px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .progress-header span { font-weight: bold; color: #2c3e50; }
        .progress-bar-outer { background: #e0e0e0; border-radius: 20px; height: 22px; overflow: hidden; margin-bottom: 10px; }
        .progress-bar-inner { height: 100%; border-radius: 20px; background: linear-gradient(90deg, #5a9d7a, #3a7d5a); transition: width 0.6s ease; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: white; font-weight: bold; min-width: 2px; }
        .progress-meta { display: flex; justify-content: space-between; font-size: 0.9rem; color: #666; }
        .mini-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .mini-card { color: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .mini-card.blue   { background: linear-gradient(135deg, #5a7fb5, #4a6fa5); }
        .mini-card.green  { background: linear-gradient(135deg, #5a9d7a, #4a8d6a); }
        .mini-card.orange { background: linear-gradient(135deg, #e89d5a, #d88d4a); }
        .mini-card h4 { font-size: 0.85rem; opacity: 0.9; margin-bottom: 10px; }
        .mini-card .val { font-size: 1.5rem; font-weight: bold; }
        .chart-container { background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .chart-wrapper { position: relative; height: 320px; width: 100%; }
        .advice-card { background: linear-gradient(135deg, #e89d5a, #d88d4a); color: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(232,157,90,0.2); }
        .advice-card h3 { font-size: 1.3rem; margin-bottom: 15px; }
        .advice-card ul { list-style: none; padding: 0; }
        .advice-card li { margin-bottom: 12px; padding-right: 24px; position: relative; line-height: 1.7; }
        .advice-card li::before { content: "âœ“"; position: absolute; right: 0; font-weight: bold; }
        .breakdown-table { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow-x: auto; margin-bottom: 30px; }
        .table-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .export-btn { padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: background 0.3s; }
        .export-btn:hover { background: #2980b9; }
        .breakdown-table table { width: 100%; border-collapse: collapse; }
        .breakdown-table th { background: #34495e; color: white; padding: 15px; text-align: right; font-weight: bold; }
        .breakdown-table td { padding: 12px 15px; border-bottom: 1px solid #e0e0e0; text-align: right; }
        .breakdown-table tr:hover { background: #f8f9fa; }
        .breakdown-table .total-row { background: #f8f9fa !important; font-weight: bold; }
        .percentage-bar { background: #e0e0e0; border-radius: 10px; height: 8px; overflow: hidden; margin-top: 5px; }
        .percentage-fill { height: 100%; background: linear-gradient(90deg, #5a7fb5, #4a6fa5); transition: width 0.5s ease; }
        .results-section { display: none; }
        @media (max-width: 968px) { .calculator-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .header h1 { font-size: 2rem; } .result-amount { font-size: 2.5rem; } .mini-cards { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<div class="container">
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">ğŸ“ˆ Ù…ÙÙƒØ±Ø© Ù…Ø³ØªØ«Ù…Ø±</a>
            <button class="navbar-toggle" onclick="toggleNavbar()">â˜°</button>
            <div class="navbar-menu" id="navbarMenu">
                <a href="index.html"                     class="navbar-item">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="advice.html"                    class="navbar-item calculator">ğŸ’° ØµØ§ÙÙŠ Ø§Ù„Ø«Ø±ÙˆØ©</a>
                <a href="salary_calculator.html"         class="navbar-item salary">ğŸ’¼ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø±Ø§ØªØ¨</a>
                <a href="zakat_purification.html"        class="navbar-item zakat">ğŸ•Œ Ø§Ù„Ø²ÙƒØ§Ø©</a>
                <a href="financial_freedom.html"         class="navbar-item fire">ğŸ”¥ Ø§Ù„Ø­Ø±ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</a>
                <a href="investor_tips.html"             class="navbar-item tips">âš ï¸ Ù†ØµØ§Ø¦Ø­</a>
                <a href="snowball_calculator.html"       class="navbar-item calculator">â„ï¸ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨</a>
                <a href="emergency_fund_calculator.html" class="navbar-item emergency active">ğŸ›¡ï¸ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</a>
                <a href="average_calculator.html"        class="navbar-item average">ğŸ“Š Ù…ØªÙˆØ³Ø· Ø§Ù„Ø´Ø±Ø§Ø¡</a>
                <a href="company_valuation.html"         class="navbar-item company">ğŸ¢ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø±ÙƒØ©</a>
                <a href="retirement_calculator.html"     class="navbar-item retirement">ğŸ–ï¸ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</a>
                <a href="portfolio_rating.html"          class="navbar-item portfolio">ğŸ›¡ï¸ Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
                <a href="stock_valuation.html"           class="navbar-item calculator">ğŸ“Š ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø³Ù‡Ù…</a>
                <a href="dca_calculator.html"            class="navbar-item calculator">ğŸ“… DCA</a>
                <a href="sell_decision.html"             class="navbar-item calculator">ğŸ¤” Ù‡Ù„ Ø£Ø¨ÙŠØ¹ØŸ</a>
                <a href="goal_calculator.html"           class="navbar-item calculator">ğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¹ÙƒØ³ÙŠ</a>
                <a href="allocation_calculator.html"     class="navbar-item allocation">âš–ï¸ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
            </div>
        </div>
    </nav>
    <script>
        function toggleNavbar(){document.getElementById('navbarMenu').classList.toggle('open');}
        document.addEventListener('DOMContentLoaded',function(){
            const page=(window.location.pathname.split('/').pop()||'index.html').split('?')[0]||'index.html';
            document.querySelectorAll('.navbar-item').forEach(function(el){
                el.classList.remove('active');
                if((el.getAttribute('href')||'').split('?')[0]===page)el.classList.add('active');
            });
        });
    </script>

    <div class="header">
        <h1>ğŸ›¡ï¸ Ø­Ø§Ø³Ø¨Ø© ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</h1>
        <p>Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø°ÙŠ ØªØ­ØªØ§Ø¬Ù‡ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…ØµØ§Ø±ÙŠÙÙƒ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</p>
    </div>

    <div class="calculator-grid">
        <div class="card">
            <h2 class="section-title">ğŸ“Š Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h2>
            <div class="input-group"><label for="housing">ğŸ  Ø§Ù„Ø³ÙƒÙ†</label><input type="number" id="housing" value="3000" min="0" step="100"></div>
            <div class="input-group"><label for="utilities">ğŸ’¡ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</label><input type="number" id="utilities" value="500" min="0" step="50"></div>
            <div class="input-group"><label for="living">ğŸ›’ Ø§Ù„Ù…Ø¹ÙŠØ´Ø©</label><input type="number" id="living" value="1500" min="0" step="100"></div>
            <div class="input-group"><label for="transport">ğŸš— Ø§Ù„Ù†Ù‚Ù„</label><input type="number" id="transport" value="800" min="0" step="50"></div>
            <div class="input-group"><label for="commitments">ğŸ’³ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</label><input type="number" id="commitments" value="600" min="0" step="50"></div>
            <div class="input-group"><label for="others">ğŸ“š Ø£Ø®Ø±Ù‰</label><input type="number" id="others" value="400" min="0" step="50"></div>
        </div>
        <div class="card">
            <h2 class="section-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‡Ø¯Ù</h2>
            <div class="select-group"><label for="coveragePeriod">Ù…Ø¯Ø© Ø§Ù„ØªØºØ·ÙŠØ©</label><select id="coveragePeriod" onchange="updateSecurityLevel()"><option value="3">3 Ø£Ø´Ù‡Ø±</option><option value="6" selected>6 Ø£Ø´Ù‡Ø±</option><option value="9">9 Ø£Ø´Ù‡Ø±</option><option value="12">12 Ø´Ù‡Ø±Ø§Ù‹</option></select></div>
            <div class="info-box"><h4>ğŸ“‹ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ù…Ø§Ù†</h4><p id="securityLevelInfo">6 Ø£Ø´Ù‡Ø± - Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø± ÙˆØ§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ù…ØªØ°Ø¨Ø°Ø¨Ø©</p></div>
            <div class="savings-group"><label for="currentSavings">ğŸ’° Ù…Ø§ ÙˆÙÙ‘Ø±ØªÙ‡ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</label><input type="number" id="currentSavings" value="0" min="0" step="500" placeholder="0"></div>
            <div class="savings-group"><label for="monthlySavings">ğŸ“¥ Ù‚Ø¯Ø±ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø¯Ø®Ø§Ø± Ø´Ù‡Ø±ÙŠØ§Ù‹</label><input type="number" id="monthlySavings" value="1000" min="0" step="100"></div>
            <div class="info-box"><h4>ğŸ’¡ Ù†ØµÙŠØ­Ø©</h4><p>Ø§Ø­ØªÙØ¸ Ø¨ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ Ù…Ù†ÙØµÙ„ØŒ Ø³Ù‡Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡.</p></div>
            <div id="errorBox" class="error-box">âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ØµØ±ÙˆÙ Ø´Ù‡Ø±ÙŠ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.</div>
            <button class="calculate-btn" onclick="calculateEmergencyFund()">Ø§Ø­Ø³Ø¨ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</button>
        </div>
    </div>

    <div class="results-section" id="resultsSection">
        <div class="result-card" id="mainResultCard">
            <h2>ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</h2>
            <div class="result-amount" id="targetAmount">-</div>
            <div class="result-period" id="coverageInfo">-</div>
        </div>
        <div class="mini-cards">
            <div class="mini-card blue"><h4>Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ø´Ù‡Ø±ÙŠ</h4><div class="val" id="miniMonthly">-</div></div>
            <div class="mini-card green"><h4>ÙˆÙÙ‘Ø±Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</h4><div class="val" id="miniSaved">-</div></div>
            <div class="mini-card orange" id="miniTimeCard"><h4>Ø§Ù„ÙˆÙ‚Øª Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‡Ø¯Ù</h4><div class="val" id="miniTimeToGoal">-</div></div>
        </div>
        <div class="progress-section">
            <div class="progress-header"><span>ğŸ“ˆ Ø§Ù„ØªÙ‚Ø¯Ù… Ù†Ø­Ùˆ Ø§Ù„Ù‡Ø¯Ù</span><span id="progressPercent">0%</span></div>
            <div class="progress-bar-outer"><div class="progress-bar-inner" id="progressBar" style="width:0%"></div></div>
            <div class="progress-meta"><span id="progressSaved">ÙˆÙÙ‘Ø±Øª: -</span><span id="progressRemaining">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: -</span></div>
        </div>
        <div class="chart-container">
            <h2 class="section-title">ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h2>
            <div class="chart-wrapper"><canvas id="expensesChart"></canvas></div>
        </div>
        <div class="advice-card"><h3>ğŸ¯ Ù†ØµØ§Ø¦Ø­ Ù…Ø§Ù„ÙŠØ© Ø°ÙƒÙŠØ©</h3><ul id="adviceList"></ul></div>
        <div class="breakdown-table">
            <div class="table-header">
                <h2 class="section-title" style="margin-bottom:0;border:none;padding:0;">ğŸ“‹ ØªÙØµÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h2>
                <button class="export-btn" onclick="exportToCSV()">ØªØµØ¯ÙŠØ± CSV</button>
            </div>
            <table><thead><tr><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø´Ù‡Ø±ÙŠ</th><th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th><th>Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ø¨ØµØ±ÙŠ</th></tr></thead><tbody id="breakdownBody"></tbody></table>
        </div>
    </div>
</div>

<script src="results-engine.js"></script>
<script>
let expensesChart=null;
const EXPENSE_LABELS={housing:'ğŸ  Ø§Ù„Ø³ÙƒÙ†',utilities:'ğŸ’¡ Ø§Ù„ÙÙˆØ§ØªÙŠØ±',living:'ğŸ›’ Ø§Ù„Ù…Ø¹ÙŠØ´Ø©',transport:'ğŸš— Ø§Ù„Ù†Ù‚Ù„',commitments:'ğŸ’³ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª',others:'ğŸ“š Ø£Ø®Ø±Ù‰'};
const CHART_COLORS=['#5a7fb5','#d67a6a','#e89d5a','#5a9d7a','#8a7ba8','#9a9fb5'];
function formatCurrency(a){return new Intl.NumberFormat('ar-SA',{style:'currency',currency:'SAR',minimumFractionDigits:0,maximumFractionDigits:0}).format(a);}
function updateSecurityLevel(){const m={'3':'3 Ø£Ø´Ù‡Ø± â€” Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³ØªÙ‚Ø±','6':'6 Ø£Ø´Ù‡Ø± â€” Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø±','9':'9 Ø£Ø´Ù‡Ø± â€” Ù„Ù„Ø¯Ø®Ù„ ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…','12':'12 Ø´Ù‡Ø±Ø§Ù‹ â€” Ù„Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„'};document.getElementById('securityLevelInfo').textContent=m[document.getElementById('coveragePeriod').value];}
function calculateEmergencyFund(){
    const expenses={housing:Math.max(parseFloat(document.getElementById('housing').value)||0,0),utilities:Math.max(parseFloat(document.getElementById('utilities').value)||0,0),living:Math.max(parseFloat(document.getElementById('living').value)||0,0),transport:Math.max(parseFloat(document.getElementById('transport').value)||0,0),commitments:Math.max(parseFloat(document.getElementById('commitments').value)||0,0),others:Math.max(parseFloat(document.getElementById('others').value)||0,0)};
    const totalMonthly=Object.values(expenses).reduce((s,v)=>s+v,0);
    const coveragePeriod=parseInt(document.getElementById('coveragePeriod').value);
    const currentSavings=Math.max(parseFloat(document.getElementById('currentSavings').value)||0,0);
    const monthlySavings=Math.max(parseFloat(document.getElementById('monthlySavings').value)||0,0);
    const errorBox=document.getElementById('errorBox');
    if(totalMonthly===0){errorBox.style.display='block';document.getElementById('resultsSection').style.display='none';return;}
    errorBox.style.display='none';
    const targetAmount=totalMonthly*coveragePeriod;
    const remaining=Math.max(targetAmount-currentSavings,0);
    document.getElementById('targetAmount').textContent=formatCurrency(targetAmount);
    document.getElementById('coverageInfo').textContent=`Ù„ØªØºØ·ÙŠØ© ${coveragePeriod} Ø£Ø´Ù‡Ø± (${formatCurrency(totalMonthly)} / Ø´Ù‡Ø±)`;
    document.getElementById('miniMonthly').textContent=formatCurrency(totalMonthly);
    document.getElementById('miniSaved').textContent=formatCurrency(currentSavings);
    if(currentSavings>=targetAmount){document.getElementById('miniTimeToGoal').textContent='âœ… Ø­Ù‚Ù‚Øª Ø§Ù„Ù‡Ø¯Ù!';}
    else if(monthlySavings<=0){document.getElementById('miniTimeToGoal').textContent='Ø­Ø¯Ø¯ Ù‚Ø¯Ø±Ø© Ø§Ù„Ø§Ø¯Ø®Ø§Ø±';}
    else{const mo=Math.ceil(remaining/monthlySavings);const yr=Math.floor(mo/12);const mn=mo%12;let t='';if(yr>0)t+=yr+' Ø³Ù†Ø© ';if(mn>0)t+=mn+' Ø´Ù‡Ø±';document.getElementById('miniTimeToGoal').textContent=t||'Ø£Ù‚Ù„ Ù…Ù† Ø´Ù‡Ø±';}
    const progressPct=Math.min((currentSavings/targetAmount)*100,100).toFixed(1);
    document.getElementById('progressPercent').textContent=progressPct+'%';
    document.getElementById('progressBar').style.width=progressPct+'%';
    document.getElementById('progressBar').textContent=progressPct>8?progressPct+'%':'';
    document.getElementById('progressSaved').textContent='ÙˆÙÙ‘Ø±Øª: '+formatCurrency(currentSavings);
    document.getElementById('progressRemaining').textContent='Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: '+formatCurrency(remaining);
    createExpensesChart(expenses);
    generateAdvice(totalMonthly,targetAmount,coveragePeriod,currentSavings,monthlySavings,expenses);
    createBreakdownTable(expenses,totalMonthly);

    /* Ø£Ù„ÙˆØ§Ù† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© */
    const card=document.getElementById('mainResultCard');
    card.classList.remove('result-positive','result-negative','result-warning');
    const pct=parseFloat(progressPct);
    if(pct>=100)card.classList.add('result-positive');
    else if(pct>=50)card.classList.add('result-warning');
    else card.classList.add('result-negative');
    if(window.ResultsEngine)window.ResultsEngine.paint();

    document.getElementById('resultsSection').style.display='block';
    document.getElementById('resultsSection').scrollIntoView({behavior:'smooth'});
}
function createExpensesChart(expenses){
    const ctx=document.getElementById('expensesChart').getContext('2d');
    const filtered=Object.entries(expenses).filter(([,v])=>v>0);
    const labels=filtered.map(([k])=>EXPENSE_LABELS[k]);
    const data=filtered.map(([,v])=>v);
    const colors=filtered.map((_,i)=>CHART_COLORS[i%CHART_COLORS.length]);
    if(expensesChart)expensesChart.destroy();
    expensesChart=new Chart(ctx,{type:'pie',data:{labels,datasets:[{data,backgroundColor:colors,borderWidth:2,borderColor:'#fff'}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{font:{size:13},padding:18}},tooltip:{callbacks:{label:ctx=>{const total=ctx.dataset.data.reduce((s,v)=>s+v,0);const pct=((ctx.parsed/total)*100).toFixed(1);return ctx.label+': '+formatCurrency(ctx.parsed)+' ('+pct+'%)';}}}}}});
}
function generateAdvice(monthly,target,period,saved,monthlySavings,expenses){
    const advice=[];
    const remaining=Math.max(target-saved,0);
    advice.push(`Ø§Ø­ØªÙØ¸ Ø¨ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ (${formatCurrency(target)}) ÙÙŠ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ Ù…Ù†ÙØµÙ„ ØªÙ…Ø§Ù…Ø§Ù‹.`);
    if(saved>=target)advice.push('ğŸ‰ Ù…Ù…ØªØ§Ø²! Ø­Ù‚Ù‚Øª Ø§Ù„Ù‡Ø¯Ù. Ø£Ø¹Ø¯ Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ø³Ù†ÙˆÙŠØ§Ù‹.');
    else if(monthlySavings>0){const months=Math.ceil(remaining/monthlySavings);advice.push(`Ø¨Ø§Ø¯Ø®Ø§Ø±Ùƒ ${formatCurrency(monthlySavings)} Ø´Ù‡Ø±ÙŠØ§Ù‹ØŒ Ø³ØªØµÙ„ Ù„Ù„Ù‡Ø¯Ù Ø®Ù„Ø§Ù„ ${months} Ø´Ù‡Ø±.`);}
    else advice.push('Ø­Ø¯Ø¯ Ù…Ø¨Ù„ØºØ§Ù‹ Ø«Ø§Ø¨ØªØ§Ù‹ ØªØ¯Ø®Ø±Ù‡ ÙƒÙ„ Ø´Ù‡Ø±.');
    if(monthly>0&&expenses.housing/monthly>0.40)advice.push(`Ø§Ù„Ø³ÙƒÙ† ÙŠÙ…Ø«Ù„ ${((expenses.housing/monthly)*100).toFixed(0)}% â€” Ù…Ø±ØªÙØ¹. Ø­Ø§ÙˆÙ„ Ø¥Ø¨Ù‚Ø§Ø¤Ù‡ Ø¯ÙˆÙ† 30%.`);
    if(monthly>0&&expenses.commitments/monthly>0.30)advice.push(`Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª (${((expenses.commitments/monthly)*100).toFixed(0)}%) Ù…Ø±ØªÙØ¹Ø© â€” ØªØ±ÙØ¹ Ø§Ø­ØªÙŠØ§Ø¬Ùƒ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦.`);
    if(target>50000&&saved<target)advice.push(`Ø§Ù„Ù…Ø¨Ù„Øº ÙƒØ¨ÙŠØ±. ÙÙƒØ± ÙÙŠ ÙˆØ¯ÙŠØ¹Ø© Ù‚ØµÙŠØ±Ø© Ø§Ù„Ø£Ø¬Ù„ Ù„Ø¬Ø²Ø¡ Ù…Ù†Ù‡.`);
    if(period<=3)advice.push('3 Ø£Ø´Ù‡Ø± Ø­Ø¯ Ø£Ø¯Ù†Ù‰ â€” ÙÙƒØ± ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€ 6 Ø£Ø´Ù‡Ø±.');
    advice.push('Ø¥Ø°Ø§ Ø³Ø­Ø¨Øª Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ØŒ Ø£Ø¹Ø¯ ØªØ¹Ø¨Ø¦ØªÙ‡ Ù‚Ø¨Ù„ Ø£ÙŠ Ø§Ø³ØªØ«Ù…Ø§Ø± Ø¢Ø®Ø±.');
    document.getElementById('adviceList').innerHTML=advice.map(a=>'<li>'+a+'</li>').join('');
}
function createBreakdownTable(expenses,total){
    const tbody=document.getElementById('breakdownBody');
    let rows='';
    for(const [key,value] of Object.entries(expenses)){const pct=total>0?((value/total)*100).toFixed(1):'0.0';rows+=`<tr><td><strong>${EXPENSE_LABELS[key]}</strong></td><td>${formatCurrency(value)}</td><td>${pct}%</td><td><div class="percentage-bar"><div class="percentage-fill" style="width:${pct}%"></div></div></td></tr>`;}
    rows+=`<tr class="total-row"><td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td><td>${formatCurrency(total)}</td><td>100%</td><td><div class="percentage-bar"><div class="percentage-fill" style="width:100%"></div></div></td></tr>`;
    tbody.innerHTML=rows;
}
function exportToCSV(){
    const expenses={housing:parseFloat(document.getElementById('housing').value)||0,utilities:parseFloat(document.getElementById('utilities').value)||0,living:parseFloat(document.getElementById('living').value)||0,transport:parseFloat(document.getElementById('transport').value)||0,commitments:parseFloat(document.getElementById('commitments').value)||0,others:parseFloat(document.getElementById('others').value)||0};
    const total=Object.values(expenses).reduce((s,v)=>s+v,0);
    const period=document.getElementById('coveragePeriod').value;
    const target=total*parseInt(period);
    const BOM='\uFEFF';
    let csv=BOM+'Ø§Ù„Ø¨Ù†Ø¯,Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø´Ù‡Ø±ÙŠ,Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©\n';
    for(const [key,value] of Object.entries(expenses)){const pct=total>0?((value/total)*100).toFixed(1):'0.0';csv+=`${EXPENSE_LABELS[key].replace(/[ğŸ ğŸ’¡ğŸ›’ğŸš—ğŸ’³ğŸ“š]/gu,'').trim()},${value},${pct}%\n`;}
    csv+=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ù‡Ø±ÙŠ,${total},100%\nØ§Ù„Ù‡Ø¯Ù (${period} Ø£Ø´Ù‡Ø±),${target},\n`;
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
    const link=document.createElement('a');
    link.href=URL.createObjectURL(blob);
    link.download='emergency_fund.csv';
    link.style.display='none';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
window.addEventListener('load',function(){updateSecurityLevel();calculateEmergencyFund();});
</script>
<script data-goatcounter="https://investornote.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
