<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ø´Ø§Ù…Ù„Ø© | Ù…ÙÙƒØ±Ø© Ù…Ø³ØªØ«Ù…Ø±</title>
    <link rel="stylesheet" href="navigation.css">
    <link rel="stylesheet" href="dark-theme.css">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; background:linear-gradient(135deg,#1e3c72,#2a5298); min-height:100vh; padding:20px; color:#2c3e50; }
        .legal-modal { position:fixed; inset:0; background:rgba(0,0,0,0.92); display:flex; justify-content:center; align-items:center; z-index:9999; }
        .modal-content { background:white; padding:40px; border-radius:20px; max-width:580px; width:90%; text-align:center; }
        .modal-content h2 { color:#1e3c72; margin-bottom:20px; }
        .modal-content p  { line-height:1.8; color:#444; margin-bottom:20px; }
        .modal-content label { display:flex; align-items:center; justify-content:center; gap:10px; cursor:pointer; font-weight:bold; margin-bottom:20px; }
        .modal-btn { padding:12px 40px; background:#667eea; color:white; border:none; border-radius:10px; font-size:1rem; font-weight:bold; cursor:pointer; transition:all 0.3s; }
        .modal-btn:disabled { background:#aaa; cursor:not-allowed; }
        .modal-btn:not(:disabled):hover { background:#5568d4; transform:translateY(-2px); }
        .container { max-width:920px; margin:0 auto; background:rgba(255,255,255,0.98); border-radius:25px; padding:35px; box-shadow:0 25px 50px rgba(0,0,0,0.3); }
        .legal-banner { background:linear-gradient(135deg,#fff3cd,#ffeaa7); border:2px solid #f39c12; border-radius:10px; padding:12px 15px; margin-bottom:25px; font-size:0.85rem; color:#856404; font-weight:bold; text-align:center; }
        h1 { text-align:center; margin-bottom:25px; font-size:2.2rem; color:#1e3c72; border-bottom:3px solid #667eea; padding-bottom:10px; }
        .section-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
        .rule-item { background:#fff; border-radius:15px; padding:20px; margin-bottom:20px; border:1px solid #e0e0e0; border-right:6px solid #667eea; transition:0.3s; }
        .rule-item:hover { transform:translateY(-3px); box-shadow:0 8px 20px rgba(0,0,0,0.07); }
        .rule-item h3 { color:#1e3c72; margin-bottom:15px; font-size:1.05rem; }
        .assets-sec   { border-right-color:#27ae60; }
        .debts-sec    { border-right-color:#e74c3c; }
        .income-sec   { border-right-color:#f1c40f; }
        .lifestyle-sec{ border-right-color:#9b59b6; }
        .input-group { margin-bottom:12px; }
        .input-group label { display:block; font-weight:600; margin-bottom:5px; font-size:0.85rem; color:#444; }
        .input-group input, .input-group select { width:100%; padding:10px; border:2px solid #edeff2; border-radius:8px; font-size:0.95rem; transition:0.3s; background:white; }
        .input-group input:focus { border-color:#667eea; outline:none; background:#f0f4ff; }
        .calculate-btn { width:100%; padding:16px; background:linear-gradient(135deg,#1e3c72,#2a5298); color:white; border:none; border-radius:12px; font-size:1.2rem; font-weight:bold; cursor:pointer; margin:20px 0; transition:all 0.3s; }
        .calculate-btn:hover { transform:translateY(-2px); box-shadow:0 8px 20px rgba(30,60,114,0.3); }
        .results-section { display:none; margin-top:30px; padding:30px; border-radius:20px; background:#f8f9fa; border:2px solid #667eea; }
        .results-section h2 { text-align:center; color:#1e3c72; margin-bottom:20px; }
        .progress-container { margin:20px 0; }
        .progress-bar-wrapper { background:#e0e0e0; border-radius:25px; height:42px; overflow:hidden; }
        .progress-fill { height:100%; width:0%; transition:width 1.2s cubic-bezier(0.1,0.7,1.0,0.1); display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; font-size:1.1rem; }
        .report-grid { display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:20px; }
        .report-card { background:white; padding:18px; border-radius:10px; border:1px solid #eee; text-align:center; }
        .report-card span { display:block; font-size:0.82rem; color:#7f8c8d; margin-bottom:6px; }
        .report-card strong { font-size:1.05rem; color:#2c3e50; }
        .timeline-container { margin-top:40px; padding:20px 15px; background:white; border-radius:15px; box-shadow:inset 0 2px 10px rgba(0,0,0,0.05); }
        .timeline-container h4 { text-align:center; margin-bottom:60px; color:#1e3c72; }
        .timeline-track { position:relative; height:12px; background:#dfe6e9; border-radius:6px; margin:70px 30px 80px; }
        .timeline-fill { position:absolute; right:0; height:100%; border-radius:6px; background:#667eea; transition:width 1s; }
        .timeline-marker { position:absolute; top:-15px; transform:translateX(50%); width:90px; }
        .marker-point { width:20px; height:20px; background:white; border:4px solid #667eea; border-radius:50%; margin:0 auto; box-shadow:0 3px 6px rgba(0,0,0,0.15); }
        .marker-label { font-size:0.75rem; font-weight:bold; margin-top:10px; color:#2d3436; line-height:1.4; text-align:center; white-space:nowrap; }
        .current-marker { top:-65px; }
        .current-icon { font-size:2rem; display:block; animation:bounce 2s infinite; }
        @keyframes bounce { 0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);} }
        .clear-btn { background:#95a5a6; color:white; border:none; padding:12px 25px; border-radius:10px; cursor:pointer; margin-top:20px; transition:all 0.3s; font-size:0.95rem; }
        .clear-btn:hover { background:#7f8c8d; transform:translateY(-2px); }
        @media (max-width:768px) { .section-grid,.report-grid { grid-template-columns:1fr; } .container { padding:20px; } h1 { font-size:1.8rem; } }
        @media (max-width:480px) { body { padding:10px; } .container { border-radius:15px; } }
    </style>
</head>
<body>
<div class="legal-modal" id="legalModal">
    <div class="modal-content">
        <h2>ğŸ›¡ï¸ Ø¥Ù‚Ø±Ø§Ø± ÙˆÙ…Ø³Ø¤ÙˆÙ„ÙŠØ© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</h2>
        <p>Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø£Ø¯Ø§Ø© <strong>ØªØ¹Ù„ÙŠÙ…ÙŠØ©</strong> ØªÙˆÙØ± ØªÙ‚Ø¯ÙŠØ±Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©. Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ø§ ØªØ¶Ù…Ù† Ø¯Ù‚Ø© Ø§Ù„ØªÙ‚Ù„Ø¨Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ÙŠØ© Ø£Ùˆ Ø§Ù„ØªØ¶Ø®Ù….</p>
        <label><input type="checkbox" id="acceptCheckbox"> Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ·</label>
        <button class="modal-btn" id="enterBtn" disabled>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    </div>
</div>

<div class="navbar" style="max-width:920px;margin:0 auto 20px;">
    <div class="navbar-container">
        <a href="index.html" class="navbar-brand">ğŸ“ˆ Ù…ÙÙƒØ±Ø© Ù…Ø³ØªØ«Ù…Ø±</a>
        <div class="navbar-menu" id="navbarMenu">
            <a href="index.html"                     class="navbar-item">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="advice.html"                    class="navbar-item">ğŸ’° ØµØ§ÙÙŠ Ø§Ù„Ø«Ø±ÙˆØ©</a>
            <a href="salary_calculator.html"         class="navbar-item">ğŸ’¼ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø±Ø§ØªØ¨</a>
            <a href="zakat_purification.html"        class="navbar-item">ğŸ•Œ Ø§Ù„Ø²ÙƒØ§Ø©</a>
            <a href="financial_freedom.html"         class="navbar-item">ğŸ”¥ Ø§Ù„Ø­Ø±ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</a>
            <a href="snowball_calculator.html"       class="navbar-item">â„ï¸ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨</a>
            <a href="emergency_fund_calculator.html" class="navbar-item">ğŸ›¡ï¸ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</a>
            <a href="company_valuation.html"         class="navbar-item">ğŸ¢ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø±ÙƒØ©</a>
            <a href="retirement_calculator.html"     class="navbar-item active">ğŸ–ï¸ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</a>
            <a href="portfolio_rating.html"          class="navbar-item">ğŸ›¡ï¸ Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
            <a href="stock_valuation.html"           class="navbar-item">ğŸ“Š ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø³Ù‡Ù…</a>
            <a href="dca_calculator.html"            class="navbar-item">ğŸ“… DCA</a>
            <a href="sell_decision.html"             class="navbar-item">ğŸ¤” Ù‡Ù„ Ø£Ø¨ÙŠØ¹ØŸ</a>
            <a href="goal_calculator.html"           class="navbar-item">ğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¹ÙƒØ³ÙŠ</a>
            <a href="allocation_calculator.html"     class="navbar-item">âš–ï¸ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
        </div>
        <button class="navbar-toggle" onclick="toggleNavbar()">â˜°</button>
    </div>
</div>

<div class="container">
    <div class="legal-banner">âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ØªÙ‚Ø¯ÙŠØ±ÙŠØ©. Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ø§ ØªÙ…Ø«Ù„ Ø§Ø³ØªØ´Ø§Ø±Ø© Ù…Ø§Ù„ÙŠØ© Ù…Ù„Ø²Ù…Ø©.</div>
    <h1>ğŸ“Š Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„ØªÙ‚Ø§Ø¹Ø¯</h1>
    <div class="section-grid">
        <div class="rule-item">
            <h3>ğŸ‘¤ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
            <div class="input-group"><label>Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</label><input type="number" id="currentAge" placeholder="30" min="15" max="80"></div>
            <div class="input-group"><label>Ø¹Ù…Ø± Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</label><input type="number" id="targetRetirementAge" placeholder="55" min="30" max="80"></div>
            <div class="input-group"><label>Ø¹Ø§Ù… Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„</label><input type="number" id="workStartYear" placeholder="2015" min="1980" max="2030"></div>
            <div class="input-group"><label>Ø³Ù†Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ± Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</label><input type="number" id="earlyRetirementYear" placeholder="2040"></div>
        </div>
        <div class="rule-item assets-sec">
            <h3>ğŸ’° Ø§Ù„Ø£ØµÙˆÙ„</h3>
            <div class="input-group"><label>Ø§Ù„ÙƒØ§Ø´ ÙˆØ§Ù„Ù…Ø¯Ø®Ø±Ø§Øª</label><input type="number" id="cashAssets" placeholder="0" min="0"></div>
            <div class="input-group"><label>Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©</label><input type="number" id="investmentPortfolio" placeholder="0" min="0"></div>
            <div class="input-group"><label>Ù†Ù…Ùˆ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø³Ù†ÙˆÙŠ (%)</label><input type="number" id="portfolioGrowth" value="8" min="0" max="30"></div>
            <div class="input-group"><label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</label><input type="number" id="realEstateValue" placeholder="0" min="0"></div>
            <div class="input-group"><label>Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù…Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±</label><input type="number" id="monthlyRental" placeholder="0" min="0"></div>
        </div>
        <div class="rule-item debts-sec">
            <h3>ğŸš— Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</h3>
            <div class="input-group"><label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø±ÙˆØ¶</label><input type="number" id="totalLoans" placeholder="0" min="0"></div>
            <div class="input-group"><label>Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label><select id="carStatus"><option value="owned">Ù…Ù„Ùƒ</option><option value="installments">Ø£Ù‚Ø³Ø§Ø·</option></select></div>
            <div id="carInstallmentGroup" class="input-group" style="display:none;"><label>Ù‚Ø³Ø· Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label><input type="number" id="carInstallment" placeholder="0" min="0"></div>
            <div class="input-group"><label>ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø´Ù‡Ø±ÙŠØ§Ù‹</label><input type="number" id="carOperating" placeholder="1000" min="0"></div>
            <div class="input-group"><label>Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ø®Ø±Ù‰</label><input type="number" id="otherObligations" placeholder="0" min="0"></div>
        </div>
        <div class="rule-item lifestyle-sec">
            <h3>ğŸ  Ø§Ù„Ø³ÙƒÙ† ÙˆÙ†Ù…Ø· Ø§Ù„Ø­ÙŠØ§Ø©</h3>
            <div class="input-group"><label>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙƒÙ†</label><select id="housingType"><option value="owned">Ù…Ù„Ùƒ</option><option value="rent">Ø¥ÙŠØ¬Ø§Ø±</option></select></div>
            <div id="rentGroup" class="input-group" style="display:none;"><label>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ</label><input type="number" id="housingAmount" placeholder="0" min="0"></div>
            <div class="input-group"><label>Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù…Ø¹ÙŠØ´Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</label><input type="number" id="basicExpenses" placeholder="0" min="0"></div>
            <div class="input-group"><label>Ø§Ù„Ø±ÙØ§Ù‡ÙŠØ© ÙˆØ§Ù„Ø³ÙØ± (Ø³Ù†ÙˆÙŠØ§Ù‹)</label><input type="number" id="annualLuxury" placeholder="0" min="0"></div>
            <div class="input-group"><label>Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„ØµØ­Ø© (Ø³Ù†ÙˆÙŠØ§Ù‹)</label><input type="number" id="annualHealth" placeholder="10000" min="0"></div>
            <div class="input-group"><label>Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ¶Ø®Ù… (%)</label><input type="number" id="inflationRate" value="3" min="0" max="20"></div>
        </div>
    </div>
    <div class="rule-item income-sec">
        <h3>ğŸ“ˆ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ</h3>
        <div class="section-grid">
            <div class="input-group"><label>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ (Ø´Ù‡Ø±ÙŠ)</label><input type="number" id="expectedPension" placeholder="0" min="0"></div>
            <div class="input-group"><label>Ù…ÙƒØ§ÙØ£Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø®Ø¯Ù…Ø©</label><input type="number" id="retirementBonus" placeholder="0" min="0"></div>
        </div>
    </div>
    <button class="calculate-btn" onclick="calculate()">ğŸ“Š Ø§Ø­Ø³Ø¨ Ø®Ø·Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</button>

    <div class="results-section" id="resultsSection">
        <h2>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>
        <div class="progress-container">
            <div class="progress-bar-wrapper"><div class="progress-fill" id="progressFill">0%</div></div>
            <p id="retirementMessage" style="text-align:center;margin-top:15px;font-weight:bold;font-size:1.05rem;"></p>
        </div>
        <div class="report-grid">
            <div class="report-card"><span>Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ (Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¶Ø®Ù…)</span><strong id="repFutureExp">â€”</strong></div>
            <div class="report-card"><span>Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (Ù‚Ø§Ø¹Ø¯Ø© 25Ã—)</span><strong id="repCapitalNeeded">â€”</strong></div>
            <div class="report-card"><span>Ø§Ù„Ø«Ø±ÙˆØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</span><strong id="repExpectedWealth">â€”</strong></div>
            <div class="report-card"><span>ØªØºØ·ÙŠØ© Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù„Ø¨ÙŠ</span><strong id="repPassiveRatio">â€”</strong></div>
        </div>
        <div class="timeline-container">
            <h4>ğŸ—“ï¸ Ø®Ø§Ø±Ø·Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø²Ù…Ù†ÙŠØ©</h4>
            <div class="timeline-track" id="timelineTrack">
                <div class="timeline-fill" id="timelineFill"></div>
                <div class="timeline-marker" id="mStart"><div class="marker-point" style="border-color:#2c3e50"></div><div class="marker-label" id="lStart"></div></div>
                <div class="timeline-marker" id="mEarly"><div class="marker-point" style="border-color:#f39c12"></div><div class="marker-label" id="lEarly"></div></div>
                <div class="timeline-marker" id="mFull"><div class="marker-point" style="border-color:#e74c3c"></div><div class="marker-label" id="lFull"></div></div>
                <div class="timeline-marker" id="mSafe"><div class="marker-point" style="border-color:#27ae60;background:#27ae60"></div><div class="marker-label" id="lSafe"></div></div>
                <div class="timeline-marker current-marker" id="mNow"><span class="current-icon">ğŸ‘¤</span><div class="marker-label" style="color:#1e3c72;font-weight:bold;">2026<br>Ø£Ù†Øª Ø§Ù„Ø¢Ù†</div></div>
            </div>
            <div style="display:flex;justify-content:space-between;padding:0 30px;font-size:0.8rem;color:#888;margin-top:5px;">
                <span id="timelineEndLabel">â€”</span><span id="timelineStartLabel">â€”</span>
            </div>
        </div>
    </div>
    <button class="clear-btn" onclick="confirmReset()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
</div>

<script src="results-engine.js"></script>
<script>
document.getElementById('acceptCheckbox').addEventListener('change',function(){document.getElementById('enterBtn').disabled=!this.checked;});
document.getElementById('enterBtn').addEventListener('click',function(){document.getElementById('legalModal').style.display='none';});
function toggleNavbar(){document.getElementById('navbarMenu').classList.toggle('collapsed');}
document.getElementById('carStatus').addEventListener('change',function(){document.getElementById('carInstallmentGroup').style.display=this.value==='installments'?'block':'none';});
document.getElementById('housingType').addEventListener('change',function(){document.getElementById('rentGroup').style.display=this.value==='rent'?'block':'none';});
function fmt(n){return Math.round(n).toLocaleString('ar-SA')+' Ø±ÙŠØ§Ù„';}

function calculate(){
    const currentYear=2026;
    const inp={
        cAge:parseInt(document.getElementById('currentAge').value)||0,
        tAge:parseInt(document.getElementById('targetRetirementAge').value)||0,
        startWork:parseInt(document.getElementById('workStartYear').value)||currentYear,
        earlyRet:parseInt(document.getElementById('earlyRetirementYear').value)||0,
        cash:parseFloat(document.getElementById('cashAssets').value)||0,
        portfolio:parseFloat(document.getElementById('investmentPortfolio').value)||0,
        growth:parseFloat(document.getElementById('portfolioGrowth').value)||8,
        realEstate:parseFloat(document.getElementById('realEstateValue').value)||0,
        rentalInc:parseFloat(document.getElementById('monthlyRental').value)||0,
        loans:parseFloat(document.getElementById('totalLoans').value)||0,
        carPay:parseFloat(document.getElementById('carInstallment').value)||0,
        carOp:parseFloat(document.getElementById('carOperating').value)||0,
        otherObl:parseFloat(document.getElementById('otherObligations').value)||0,
        rentPay:parseFloat(document.getElementById('housingAmount').value)||0,
        basicExp:parseFloat(document.getElementById('basicExpenses').value)||0,
        luxuryAnn:parseFloat(document.getElementById('annualLuxury').value)||0,
        healthAnn:parseFloat(document.getElementById('annualHealth').value)||0,
        inflation:parseFloat(document.getElementById('inflationRate').value)||3,
        pension:parseFloat(document.getElementById('expectedPension').value)||0,
        bonus:parseFloat(document.getElementById('retirementBonus').value)||0,
    };
    if(inp.basicExp<=0||inp.cAge<=0||inp.tAge<=inp.cAge){alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©.');return;}
    const yearsToRetire=inp.tAge-inp.cAge;
    const fullRetYear=currentYear+yearsToRetire;
    const currentMonthlyExp=inp.basicExp+inp.rentPay+inp.carPay+inp.carOp+inp.otherObl+(inp.luxuryAnn/12);
    const futureMonthlyExp=(currentMonthlyExp*Math.pow(1+inp.inflation/100,yearsToRetire))+(inp.healthAnn/12);
    const futureRentalInc=inp.rentalInc*Math.pow(1+(inp.inflation*0.5)/100,yearsToRetire);
    const futurePassiveInc=inp.pension+futureRentalInc;
    const monthlyGap=Math.max(0,futureMonthlyExp-futurePassiveInc);
    const capitalNeeded=monthlyGap*12*25;
    const netAssets=(inp.cash+inp.portfolio+inp.realEstate)-inp.loans;
    const expectedWealth=(netAssets*Math.pow(1+inp.growth/100,yearsToRetire))+inp.bonus;
    const readiness=capitalNeeded<=0?100:Math.min(100,(expectedWealth/capitalNeeded)*100);
    const passiveRatio=futureMonthlyExp>0?Math.round((futurePassiveInc/futureMonthlyExp)*100):0;

    const fill=document.getElementById('progressFill');
    fill.style.width=readiness+'%';
    fill.textContent=Math.round(readiness)+'%';
    fill.style.background=readiness>75?'#27ae60':(readiness>45?'#f39c12':'#e74c3c');
    const msg=document.getElementById('retirementMessage');
    if(passiveRatio>=100){msg.innerHTML='ğŸ ØªÙ‡Ø§Ù†ÙŠØ§Ù‹! Ø¯Ø®Ù„Ùƒ Ø§Ù„Ø³Ù„Ø¨ÙŠ ÙŠØºØ·ÙŠ Ù…ØµØ§Ø±ÙŠÙÙƒ.';msg.style.color='#27ae60';}
    else{msg.innerHTML=`â³ Ø£Ù†Øª ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡. Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù„Ø¨ÙŠ ÙŠØºØ·ÙŠ ${passiveRatio}% Ù…Ù† Ù…ØµØ§Ø±ÙŠÙÙƒ.`;msg.style.color='#2c3e50';}
    document.getElementById('repFutureExp').innerText=fmt(futureMonthlyExp);
    document.getElementById('repCapitalNeeded').innerText=fmt(capitalNeeded);
    document.getElementById('repExpectedWealth').innerText=fmt(expectedWealth);
    document.getElementById('repPassiveRatio').innerText=passiveRatio+'%';

    /* Ø£Ù„ÙˆØ§Ù† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ø¹Ù„Ù‰ results-section */
    const sec=document.getElementById('resultsSection');
    sec.classList.remove('result-positive','result-negative','result-warning');
    if(readiness>=75)      sec.classList.add('result-positive');
    else if(readiness>=45) sec.classList.add('result-warning');
    else                   sec.classList.add('result-negative');
    if(window.ResultsEngine)window.ResultsEngine.paint();

    const safeYear=simulateSafeYear(inp,netAssets,currentMonthlyExp);
    drawTimeline(inp.startWork,inp.earlyRet,fullRetYear,safeYear,currentYear);
    document.getElementById('resultsSection').style.display='block';
    document.getElementById('resultsSection').scrollIntoView({behavior:'smooth'});
}

function simulateSafeYear(inp,assets,monthlyExp){
    const retireYear=2026+(inp.tAge-inp.cAge);
    for(let y=2026;y<=2085;y++){
        const diff=y-2026;
        const curAssets=assets*Math.pow(1+inp.growth/100,diff);
        const curExpAnn=(monthlyExp*12*Math.pow(1+inp.inflation/100,diff))+inp.healthAnn;
        const curRental=inp.rentalInc*Math.pow(1+(inp.inflation*0.5)/100,diff)*12;
        const pension=y>=retireYear?inp.pension*12:0;
        const totalIncome=curRental+pension;
        if(totalIncome>=curExpAnn||(totalIncome+curAssets*0.04)>=curExpAnn)return y;
    }
    return 2085;
}

function drawTimeline(start,early,full,safe,now){
    const span=Math.max(full-start,1);
    const getPosRTL=(year)=>Math.min(100,Math.max(0,((year-start)/span)*100));
    const place=(id,year,label)=>{
        const el=document.getElementById(id);if(!el)return;
        el.style.right=getPosRTL(year)+'%';el.style.position='absolute';
        document.getElementById(id.replace('m','l')).innerHTML=label;
    };
    place('mStart',start,`${start}<br>Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©`);
    place('mFull',full,`${full}<br>Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯`);
    if(early>0)place('mEarly',early,`${early}<br>Ù…Ø¨ÙƒØ± ğŸ¯`);
    place('mSafe',safe,`${safe}<br>Ø¢Ù…Ù† âœ…`);
    const nowEl=document.getElementById('mNow');
    nowEl.style.right=getPosRTL(now)+'%';nowEl.style.position='absolute';
    document.getElementById('timelineFill').style.width=getPosRTL(now)+'%';
    document.getElementById('timelineStartLabel').textContent=`${start} â€” Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©`;
    document.getElementById('timelineEndLabel').textContent=`${full} â€” Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯`;
}

function confirmReset(){if(confirm('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ'))window.location.reload();}
</script>
</body>
</html>
