<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ·Ù‡ÙŠØ± ÙˆØ§Ù„Ø²ÙƒØ§Ø© - Ù…ÙÙƒØ±Ø© Ù…Ø³ØªØ«Ù…Ø±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: linear-gradient(135deg, #e8f0f5 0%, #d0e0e8 100%);
            min-height: 100vh; padding: 20px; color: #2c3e50;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        /* ===== Header ===== */
        .header { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        .header p  { font-size: 1.1rem; opacity: 0.8; }

        /* ===== Sections ===== */
        .calculator-section,
        .results-section,
        .backup-section {
            background: white; border-radius: 15px;
            padding: 30px; margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.4rem; color: #2c3e50;
            margin-bottom: 25px; padding-bottom: 10px;
            border-bottom: 3px solid #5a7fb5;
        }

        /* ===== Table ===== */
        .dividends-table {
            width: 100%; border-collapse: collapse; margin-bottom: 15px;
        }
        .dividends-table th,
        .dividends-table td {
            padding: 12px; text-align: right;
            border-bottom: 1px solid #e9ecef;
        }
        .dividends-table th {
            background: #f8f9fa; font-weight: bold; color: #2c3e50;
        }
        .dividends-table input {
            width: 100%; padding: 8px; border: 1px solid #ddd;
            border-radius: 4px; font-size: 0.9rem; background: white;
        }
        .dividends-table input:focus { outline: none; border-color: #5a7fb5; }

        /* âœ… Ø¥ØµÙ„Ø§Ø­: Ø²Ø± Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ø¨ØªØµÙ…ÙŠÙ… ÙˆØ§Ø¶Ø­ */
        .remove-btn {
            background: #d67a6a; color: white; border: none;
            padding: 6px 12px; border-radius: 6px; cursor: pointer;
            font-size: 0.85rem; transition: all 0.2s;
        }
        .remove-btn:hover { background: #c66a5a; transform: translateY(-1px); }

        .add-dividend-btn {
            background: linear-gradient(135deg, #5a9d7a, #6aad8a);
            color: white; border: none; padding: 12px 24px;
            border-radius: 8px; cursor: pointer; font-size: 1rem;
            margin-bottom: 20px; transition: all 0.3s;
        }
        .add-dividend-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(90,157,122,0.3); }

        /* ===== Zakat Section ===== */
        .zakat-section {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            border-radius: 15px; padding: 30px;
            margin-bottom: 30px; border: 2px solid #5a9d7a;
        }
        .zakat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px; margin-bottom: 20px;
        }
        .zakat-input-group {
            background: white; padding: 20px;
            border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .zakat-input-group label {
            display: block; margin-bottom: 8px;
            font-weight: bold; color: #2c3e50; font-size: 0.9rem;
        }
        .zakat-input-group input,
        .zakat-input-group select {
            width: 100%; padding: 12px; border: 2px solid #e0e0e0;
            border-radius: 8px; font-size: 1rem; background: white;
            transition: border-color 0.3s;
        }
        .zakat-input-group input:focus,
        .zakat-input-group select:focus { outline: none; border-color: #5a9d7a; }

        /* ===== Results ===== */
        .results-section { display: none; }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .result-card {
            background: linear-gradient(135deg, #5a7fb5, #6a8fc5);
            color: white; padding: 25px; border-radius: 15px;
            text-align: center; box-shadow: 0 4px 15px rgba(90,127,181,0.3);
        }
        .result-card.green { background: linear-gradient(135deg, #5a9d7a, #6aad8a); }

        .result-card h3     { font-size: 1.1rem; margin-bottom: 12px; opacity: 0.9; }
        .result-amount      { font-size: 2.2rem; font-weight: bold; margin-bottom: 8px; }
        .result-detail      { font-size: 0.85rem; opacity: 0.85; margin-top: 8px; }

        /* Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ */
        .chart-wrapper {
            position: relative; height: 280px; margin-top: 20px;
        }

        /* ===== Backup Section â€” âœ… CSS Ù…Ø¶Ø§Ù ===== */
        .backup-buttons {
            display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 15px;
        }
        .backup-btn {
            padding: 12px 20px; border: none; border-radius: 8px;
            cursor: pointer; font-size: 0.95rem; font-weight: bold;
            transition: all 0.3s; flex: 1; min-width: 160px;
        }
        .export-btn { background: #5a7fb5; color: white; }
        .export-btn:hover { background: #4a6fa5; transform: translateY(-2px); }
        .import-btn { background: #5a9d7a; color: white; }
        .import-btn:hover { background: #4a8d6a; transform: translateY(-2px); }
        .clear-btn  { background: #d67a6a; color: white; }
        .clear-btn:hover  { background: #c66a5a; transform: translateY(-2px); }

        .backup-note {
            font-size: 0.85rem; color: #666; margin-top: 10px;
            padding: 10px; background: #f8f9fa; border-radius: 6px;
        }

        /* ===== Calculate Button ===== */
        .calculate-btn {
            width: 100%; padding: 15px;
            background: linear-gradient(135deg, #5a7fb5, #4a6fa5);
            color: white; border: none; border-radius: 10px;
            font-size: 1.2rem; font-weight: bold; cursor: pointer;
            transition: all 0.3s; margin-bottom: 30px;
        }
        .calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(90,127,181,0.3); }

        /* ===== Tips Link ===== */
        .tips-link {
            text-align: center; padding: 20px;
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-radius: 10px; border: 2px solid #ffc107; margin-top: 20px;
        }
        .tips-link a { color: #856404; text-decoration: none; font-weight: bold; font-size: 1.1rem; }
        .tips-link a:hover { text-decoration: underline; }

        /* ===== Responsive ===== */
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .calculator-section { padding: 20px; }
            .dividends-table { font-size: 0.85rem; }
            .dividends-table th:nth-child(5),
            .dividends-table td:nth-child(5) { display: none; } /* Ø¥Ø®ÙØ§Ø¡ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            .backup-buttons { flex-direction: column; }
            .backup-btn { min-width: unset; }
        }

        @media (max-width: 480px) {
            body { padding: 10px; }
            .calculator-section { padding: 15px; }
        }
    </style>
    <link rel="stylesheet" href="navigation.css">
</head>
<body>
<div class="container">

    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">ğŸ“ˆ Ù…ÙÙƒØ±Ø© Ù…Ø³ØªØ«Ù…Ø±</a>
            <div class="navbar-menu" id="navbarMenu">
                <a href="index.html"                     class="navbar-item">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="advice.html"                    class="navbar-item calculator">ğŸ’° Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø«Ø±ÙˆØ©</a>
                <a href="salary_calculator.html"         class="navbar-item salary">ğŸ’¼ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø±Ø§ØªØ¨</a>
                <a href="zakat_purification.html"        class="navbar-item zakat">ğŸ•Œ Ø§Ù„ØªØ·Ù‡ÙŠØ± ÙˆØ§Ù„Ø²ÙƒØ§Ø©</a>
                <a href="financial_freedom.html"         class="navbar-item fire">ğŸ”¥ Ø§Ù„Ø­Ø±ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</a>
                <a href="investor_tips.html"             class="navbar-item tips">âš ï¸ Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</a>
                <a href="snowball_calculator.html"       class="navbar-item calculator">â„ï¸ Ø­Ø§Ø³Ø¨Ø© ÙƒØ±Ø© Ø§Ù„Ø«Ù„Ø¬</a>
                <a href="emergency_fund_calculator.html" class="navbar-item emergency">ğŸ›¡ï¸ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</a>
                <a href="average_calculator.html"        class="navbar-item calculator">ğŸ“Š Ù…ØªÙˆØ³Ø· Ø§Ù„Ø´Ø±Ø§Ø¡</a>
                <a href="company_valuation.html"         class="navbar-item calculator">ğŸ¢ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø±ÙƒØ©</a>
                <a href="retirement_calculator.html"     class="navbar-item calculator">ğŸ–ï¸ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</a>
                <a href="portfolio_rating.html"          class="navbar-item calculator">ğŸ›¡ï¸ Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
                <a href="stock_valuation.html"           class="navbar-item valuation">ğŸ“Š ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø³Ù‡Ù…</a>
            </div>
            <button class="navbar-toggle" onclick="toggleNavbar()">â˜°</button>
        </div>
    </nav>
    <script>
        function toggleNavbar() { document.getElementById('navbarMenu').classList.toggle('collapsed'); }
        document.addEventListener('DOMContentLoaded', function () {
            const cur = window.location.pathname.split('/').pop() || 'index.html';
            document.querySelectorAll('.navbar-item').forEach(el => {
                if (el.getAttribute('href') === cur || (cur === '' && el.getAttribute('href') === 'index.html'))
                    el.classList.add('active');
            });
        });
    </script>

    <!-- ===== Header ===== -->
    <div class="header">
        <h1>ğŸ•Œ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ·Ù‡ÙŠØ± ÙˆØ§Ù„Ø²ÙƒØ§Ø©</h1>
        <p>Ø·Ù‡Ù‘Ø± Ø«Ø±ÙˆØªÙƒ Ù…Ù† Ø§Ù„Ø­Ø±Ø§Ù… ÙˆØ§Ø­Ø³Ø¨ Ø²ÙƒØ§Ø© Ù…Ø­ÙØ¸ØªÙƒ Ø¨Ø¯Ù‚Ø©</p>
    </div>

    <!-- ===== Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª ===== -->
    <div class="calculator-section">
        <h2 class="section-title">ğŸ“Š Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</h2>
        <p style="margin-bottom:20px; color:#555;">
            Ø£Ø¯Ø®Ù„ Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª Ø§Ù„ØªÙŠ Ø§Ø³ØªÙ„Ù…ØªÙ‡Ø§ Ù…Ù† ÙƒÙ„ Ø³Ù‡Ù… ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„ØªØ·Ù‡ÙŠØ± Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©.
        </p>

        <table class="dividends-table" id="dividendsTable">
            <thead>
                <tr>
                    <th>Ø§Ø³Ù… Ø§Ù„Ø³Ù‡Ù…</th>
                    <th>Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª (Ø±ÙŠØ§Ù„)</th>
                    <th>Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ·Ù‡ÙŠØ± (%)</th>
                    <th>Ù…Ø¨Ù„Øº Ø§Ù„ØªØ·Ù‡ÙŠØ±</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody id="dividendsBody">
                <!-- Ø³Ø·Ø± Ø£ÙˆÙ„ÙŠ -->
            </tbody>
        </table>

        <button class="add-dividend-btn" onclick="addDividend()">+ Ø¥Ø¶Ø§ÙØ© Ø³Ù‡Ù…</button>

        <!-- Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø§Ù„ÙŠØ¯ÙˆÙŠ -->
        <button onclick="saveRows()"
                style="background:#5a7fb5; color:white; border:none; padding:10px 20px;
                       border-radius:8px; cursor:pointer; font-size:0.95rem; margin-right:10px;
                       transition:all 0.2s;">
            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </button>
    </div>

    <!-- ===== Ø§Ù„Ø²ÙƒØ§Ø© ===== -->
    <div class="zakat-section">
        <h2 class="section-title" style="border-color:#5a9d7a;">ğŸ•Œ Ø­Ø³Ø§Ø¨ Ø²ÙƒØ§Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©</h2>
        <div class="zakat-grid">
            <div class="zakat-input-group">
                <label for="portfolioValue">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø±ÙŠØ§Ù„)</label>
                <input type="number" id="portfolioValue" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©" min="0">
            </div>
            <div class="zakat-input-group">
                <label for="nisabType">Ù†ÙˆØ¹ Ø§Ù„Ù†ØµØ§Ø¨</label>
                <select id="nisabType" onchange="toggleSilverPrice()">
                    <option value="gold">Ø°Ù‡Ø¨ (85 Ø¬Ø±Ø§Ù…)</option>
                    <option value="silver">ÙØ¶Ø© (595 Ø¬Ø±Ø§Ù…)</option>
                </select>
            </div>
            <!-- âœ… Ø³Ø¹Ø± Ø§Ù„Ø°Ù‡Ø¨ Ù…Ù†ÙØµÙ„ -->
            <div class="zakat-input-group">
                <label for="goldPrice">Ø³Ø¹Ø± Ø¬Ø±Ø§Ù… Ø§Ù„Ø°Ù‡Ø¨ (Ø±ÙŠØ§Ù„)</label>
                <input type="number" id="goldPrice" value="420" min="1"
                       placeholder="Ù…Ø«Ø§Ù„: 420">
            </div>
            <!-- âœ… Ø³Ø¹Ø± Ø§Ù„ÙØ¶Ø© â€” ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ¶Ø© -->
            <div class="zakat-input-group" id="silverPriceGroup" style="display:none;">
                <label for="silverPrice">Ø³Ø¹Ø± Ø¬Ø±Ø§Ù… Ø§Ù„ÙØ¶Ø© (Ø±ÙŠØ§Ù„)</label>
                <input type="number" id="silverPrice" value="5.2" min="0.1" step="0.1"
                       placeholder="Ù…Ø«Ø§Ù„: 5.2">
            </div>
        </div>
    </div>

    <button class="calculate-btn" onclick="calculateAll()">âš–ï¸ Ø§Ø­Ø³Ø¨ Ø§Ù„ØªØ·Ù‡ÙŠØ± ÙˆØ§Ù„Ø²ÙƒØ§Ø©</button>

    <!-- ===== Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ===== -->
    <div id="resultsSection" class="results-section">
        <h2 class="section-title">ğŸ“‹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>

        <div class="results-grid">
            <div class="result-card">
                <h3>ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ·Ù‡ÙŠØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</h3>
                <div class="result-amount" id="totalPurification">â€”</div>
                <div class="result-detail"  id="purificationDetail"></div>
            </div>
            <div class="result-card green">
                <h3>ğŸ•Œ Ø²ÙƒØ§Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©</h3>
                <div class="result-amount" id="zakatAmount">â€”</div>
                <div class="result-detail"  id="zakatDetails"></div>
            </div>
            <div class="result-card" style="background:linear-gradient(135deg,#2c3e50,#34495e);">
                <h3>ğŸ’³ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø¥Ø®Ø±Ø§Ø¬Ù‡</h3>
                <div class="result-amount" id="totalDue">â€”</div>
                <div class="result-detail">ØªØ·Ù‡ÙŠØ± + Ø²ÙƒØ§Ø©</div>
            </div>
        </div>

        <!-- âœ… Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ â€” Chart.js ÙŠÙØ³ØªØ®Ø¯Ù… ÙØ¹Ù„Ø§Ù‹ -->
        <div class="chart-wrapper">
            <canvas id="zakatChart"></canvas>
        </div>
    </div>

    <!-- ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª â€” âœ… Ø¯Ø§Ø®Ù„ .container ===== -->
    <div class="backup-section">
        <h2 class="section-title">ğŸ’¾ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
        <p style="margin-bottom:15px; color:#555; font-size:0.9rem;">
            Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø®Ø²Ù†Ø© ÙÙŠ Ù…ØªØµÙØ­Ùƒ ÙÙ‚Ø·. ØµØ¯Ù‘Ø± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¯ÙˆØ±ÙŠØ§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ÙÙ‚Ø¯Ø§Ù†Ù‡Ø§.
        </p>
        <div class="backup-buttons">
            <button class="backup-btn export-btn" onclick="exportData()">ğŸ“¤ ØªØµØ¯ÙŠØ± (CSV)</button>
            <button class="backup-btn import-btn" onclick="document.getElementById('importFile').click()">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
            <input type="file" id="importFile" accept=".csv" style="display:none;" onchange="importData(this)">
            <button class="backup-btn clear-btn"  onclick="clearAllData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
        <p class="backup-note">âš ï¸ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙŠØ³ØªØ¨Ø¯Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ø§Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯.</p>
    </div>

    <!-- ===== Tips ===== -->
    <div class="tips-link">
        <p>ğŸ“š Ù„Ù„ØªØ°ÙƒÙŠØ± Ø¨Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± ÙˆØ§Ù„ØªØ·Ù‡ÙŠØ±:</p>
        <a href="investor_tips.html">Ø§Ù‚Ø±Ø£ Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± â†</a>
    </div>

</div><!-- end .container -->

<script>
/* =====================================================
   Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ†
   ===================================================== */
const STORAGE_KEY = 'zakat_purification_rows';

/* =====================================================
   ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„Ø©
   ===================================================== */
function formatCurrency(n) {
    return new Intl.NumberFormat('ar-SA', {
        style: 'currency', currency: 'SAR',
        minimumFractionDigits: 2, maximumFractionDigits: 2
    }).format(n);
}

/* =====================================================
   Ø³Ø¹Ø± Ø§Ù„ÙØ¶Ø© â€” Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡
   ===================================================== */
function toggleSilverPrice() {
    const nisab = document.getElementById('nisabType').value;
    document.getElementById('silverPriceGroup').style.display =
        nisab === 'silver' ? 'block' : 'none';
}

/* =====================================================
   Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±
   ===================================================== */
function addDividend(name = '', amount = '', rate = '10') {
    const tbody = document.getElementById('dividendsBody');
    const tr    = document.createElement('tr');
    tr.className = 'dividend-row';
    tr.innerHTML = `
        <td><input type="text"   class="stock-name"        placeholder="Ø§Ø³Ù… Ø§Ù„Ø³Ù‡Ù…" value="${name}"></td>
        <td><input type="number" class="dividend-amount"   placeholder="0" min="0" value="${amount}"></td>
        <td><input type="number" class="purification-rate" placeholder="10" min="0" max="100" value="${rate}"></td>
        <td class="purification-amount" style="font-weight:bold; color:#5a7fb5;">â€”</td>
        <td><button class="remove-btn" onclick="removeDividend(this)">ğŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø©</button></td>
    `;
    tbody.appendChild(tr);
    updateRowPurification(tr); // Ø§Ø­Ø³Ø¨ ÙÙˆØ±Ø§Ù‹
}

/* =====================================================
   Ø­Ø°Ù Ø³Ø·Ø±
   ===================================================== */
function removeDividend(btn) {
    const rows = document.querySelectorAll('.dividend-row');
    if (rows.length > 1) btn.closest('tr').remove();
    else alert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ù‚Ù‰ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.');
}

/* =====================================================
   ØªØ­Ø¯ÙŠØ« ØªØ·Ù‡ÙŠØ± Ø³Ø·Ø± ÙˆØ§Ø­Ø¯
   ===================================================== */
function updateRowPurification(row) {
    const amount = parseFloat(row.querySelector('.dividend-amount').value)   || 0;
    const rate   = parseFloat(row.querySelector('.purification-rate').value) || 0;
    const purif  = (amount * rate) / 100;
    row.querySelector('.purification-amount').textContent = formatCurrency(purif);
}

/* =====================================================
   Ø­Ø³Ø§Ø¨ ÙƒÙ„ Ø§Ù„ØªØ·Ù‡ÙŠØ±
   ===================================================== */
function calculatePurification() {
    let total = 0;
    document.querySelectorAll('.dividend-row').forEach(row => {
        updateRowPurification(row);
        const amount = parseFloat(row.querySelector('.dividend-amount').value)   || 0;
        const rate   = parseFloat(row.querySelector('.purification-rate').value) || 0;
        total += (amount * rate) / 100;
    });
    return total;
}

/* =====================================================
   Ø­Ø³Ø§Ø¨ Ø§Ù„Ø²ÙƒØ§Ø© â€” âœ… Ø³Ø¹Ø± Ø§Ù„ÙØ¶Ø© Ù…Ù†ÙØµÙ„
   ===================================================== */
function calculateZakat() {
    const portfolioValue = parseFloat(document.getElementById('portfolioValue').value) || 0;
    const nisabType      = document.getElementById('nisabType').value;
    const goldPrice      = parseFloat(document.getElementById('goldPrice').value) || 420;
    const silverPrice    = parseFloat(document.getElementById('silverPrice').value) || 5.2;

    let nisab;
    if (nisabType === 'gold') {
        nisab = 85 * goldPrice;                 // 85 Ø¬Ø±Ø§Ù… Ø°Ù‡Ø¨
    } else {
        nisab = 595 * silverPrice;              // âœ… 595 Ø¬Ø±Ø§Ù… ÙØ¶Ø© Ø¨Ø³Ø¹Ø±Ù‡Ø§ Ø§Ù„Ù…Ø³ØªÙ‚Ù„
    }

    if (portfolioValue >= nisab) {
        const zakatAmount = portfolioValue * 0.025;
        return {
            zakatAmount,
            nisab,
            details: `Ø§Ù„Ù†ØµØ§Ø¨: ${formatCurrency(nisab)} â€” ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù†ØµØ§Ø¨ âœ… Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ø¬Ø¨Ø©`,
            eligible: true
        };
    } else {
        return {
            zakatAmount: 0,
            nisab,
            details: `Ø§Ù„Ù†ØµØ§Ø¨: ${formatCurrency(nisab)} â€” Ù„Ù… ØªØ¨Ù„Øº Ø§Ù„Ù†ØµØ§Ø¨ âŒ Ù„Ø§ Ø²ÙƒØ§Ø©`,
            eligible: false
        };
    }
}

/* =====================================================
   Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ÙƒØ§Ù…Ù„ + Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
   ===================================================== */
let zakatChart = null;

function calculateAll() {
    const totalPurification         = calculatePurification();
    const { zakatAmount, details, nisab, eligible } = calculateZakat();
    const totalDue                  = totalPurification + zakatAmount;

    // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù… ÙˆØ§Ù„Ù…Ø¨Ø§Ù„Øº Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
    const rows    = document.querySelectorAll('.dividend-row');
    const numRows = Array.from(rows).filter(r =>
        parseFloat(r.querySelector('.dividend-amount').value) > 0
    ).length;

    document.getElementById('totalPurification').textContent =
        formatCurrency(totalPurification);
    document.getElementById('purificationDetail').textContent =
        `Ù…Ù† ${numRows} Ø³Ù‡Ù…/ØµÙ†Ø¯ÙˆÙ‚`;

    document.getElementById('zakatAmount').textContent = formatCurrency(zakatAmount);
    document.getElementById('zakatDetails').textContent = details;

    document.getElementById('totalDue').textContent = formatCurrency(totalDue);

    // ===== Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ =====
    const ctx = document.getElementById('zakatChart').getContext('2d');
    const chartData = {
        labels: ['Ø§Ù„ØªØ·Ù‡ÙŠØ±', 'Ø§Ù„Ø²ÙƒØ§Ø©'],
        datasets: [{
            data: [totalPurification, zakatAmount],
            backgroundColor: ['#5a7fb5', '#5a9d7a'],
            borderWidth: 2, borderColor: '#fff'
        }]
    };

    if (zakatChart) {
        zakatChart.data    = chartData;
        zakatChart.update();
    } else {
        zakatChart = new Chart(ctx, {
            type: 'doughnut',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '55%',
                plugins: {
                    legend: { position: 'bottom', rtl: true },
                    tooltip: {
                        callbacks: {
                            label: c => ` ${c.label}: ${formatCurrency(c.parsed)}`
                        }
                    }
                }
            }
        });
    }

    document.getElementById('resultsSection').style.display = 'block';
    document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
}

/* =====================================================
   ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ·Ù‡ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
   ===================================================== */
document.addEventListener('input', e => {
    if (e.target.classList.contains('dividend-amount') ||
        e.target.classList.contains('purification-rate')) {
        updateRowPurification(e.target.closest('tr'));
    }
});

/* =====================================================
   Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† localStorage
   âœ… ÙŠØ­ÙØ¸ ÙÙ‚Ø· Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ù‡ÙŠØ± â€” Ù„Ø§ ÙŠÙ…Ø³ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø®Ø±Ù‰
   ===================================================== */
function saveRows() {
    const rows = Array.from(document.querySelectorAll('.dividend-row')).map(row => ({
        name:   row.querySelector('.stock-name').value,
        amount: row.querySelector('.dividend-amount').value,
        rate:   row.querySelector('.purification-rate').value,
    }));
    localStorage.setItem(STORAGE_KEY, JSON.stringify(rows));
    alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.');
}

function loadRows() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (!saved) { addDividend(); return; } // Ø³Ø·Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ

    try {
        const rows = JSON.parse(saved);
        if (rows.length === 0) { addDividend(); return; }
        rows.forEach(r => addDividend(r.name, r.amount, r.rate));
    } catch {
        addDividend();
    }
}

/* =====================================================
   ØªØµØ¯ÙŠØ± â€” âœ… ÙŠØµØ¯Ù‘Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ù‡ÙŠØ± ÙÙ‚Ø·
   ===================================================== */
function exportData() {
    const rows = Array.from(document.querySelectorAll('.dividend-row'));
    if (rows.length === 0) { alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±.'); return; }

    const BOM  = '\uFEFF';
    let csv    = BOM + 'Ø§Ø³Ù… Ø§Ù„Ø³Ù‡Ù…,Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª,Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ·Ù‡ÙŠØ±\n';
    rows.forEach(row => {
        const name   = row.querySelector('.stock-name').value        || '';
        const amount = row.querySelector('.dividend-amount').value   || '0';
        const rate   = row.querySelector('.purification-rate').value || '0';
        csv += `"${name}","${amount}","${rate}"\n`;
    });

    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href     = URL.createObjectURL(blob);
    link.download = `purification_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
}

/* =====================================================
   Ø§Ø³ØªÙŠØ±Ø§Ø¯ â€” âœ… ÙŠØ³ØªÙˆØ±Ø¯ ÙÙ‚Ø· ÙˆÙŠÙØ¶ÙŠÙ Ø¨Ø¯Ù„ Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙƒØ§Ù…Ù„
   ===================================================== */
function importData(input) {
    const file = input.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
        const lines = e.target.result.replace(/^\uFEFF/, '').split('\n').slice(1); // ØªØ¬Ø§Ù‡Ù„ BOM ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù†
        const tbody = document.getElementById('dividendsBody');

        if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©ØŸ')) return;
        tbody.innerHTML = '';

        lines.forEach(line => {
            if (!line.trim()) return;
            const parts = parseCSVLine(line);
            if (parts.length >= 3) addDividend(parts[0], parts[1], parts[2]);
        });

        saveRows();
        alert('âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­.');
    };
    reader.readAsText(file, 'UTF-8');
    input.value = ''; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù„Ù‚Ø¨ÙˆÙ„ Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
}

function parseCSVLine(line) {
    const result = []; let current = ''; let inQuotes = false;
    for (const char of line) {
        if (char === '"')               inQuotes = !inQuotes;
        else if (char === ',' && !inQuotes) { result.push(current.replace(/^"|"$/g,'')); current = ''; }
        else current += char;
    }
    result.push(current.replace(/^"|"$/g,''));
    return result;
}

/* =====================================================
   Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª â€” âœ… ÙŠÙ…Ø³Ø­ STORAGE_KEY ÙÙ‚Ø·
   ===================================================== */
function clearAllData() {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ù‡ÙŠØ±ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹.')) return;
    localStorage.removeItem(STORAGE_KEY);
    document.getElementById('dividendsBody').innerHTML = '';
    addDividend();
    alert('âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
}

/* =====================================================
   ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
   ===================================================== */
document.addEventListener('DOMContentLoaded', loadRows);
</script>

<script data-goatcounter="https://investornote.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</body>
</html>
