<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© ÙƒØ±Ø© Ø§Ù„Ø«Ù„Ø¬ - Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨</title>
    <link rel="stylesheet" href="navigation.css">
    <link rel="stylesheet" href="dark-theme.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Arial, sans-serif; background: linear-gradient(135deg, #e8f0f5 0%, #d0e0e8 100%); min-height: 100vh; padding: 20px; color: #2c3e50; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .calculator-container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .input-panel, .results-panel { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .section-title { font-size: 1.4rem; color: #2c3e50; margin-bottom: 25px; padding-bottom: 10px; border-bottom: 3px solid #5a9d7a; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #34495e; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #5a9d7a; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .checkbox-group { display: flex; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .checkbox-group input[type="checkbox"] { width: auto; margin-left: 10px; transform: scale(1.2); }
        .radio-group { display: flex; gap: 20px; margin-top: 8px; }
        .radio-option { display: flex; align-items: center; cursor: pointer; padding: 8px 12px; border-radius: 6px; transition: background-color 0.3s ease; }
        .radio-option:hover { background-color: #f8f9fa; }
        .radio-option input[type="radio"] { margin-left: 8px; margin-right: 0; }
        .calculate-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #5a9d7a, #6aad8a); color: white; border: none; border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; margin-top: 20px; }
        .calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(90,157,122,0.3); }
        .summary-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
        .summary-card { color: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .summary-card.deposits { background: linear-gradient(135deg, #5a7fb5, #4a6fa5); }
        .summary-card.earnings { background: linear-gradient(135deg, #5a9d7a, #4a8d6a); }
        .summary-card.final   { background: linear-gradient(135deg, #d67a6a, #c66a5a); }
        .summary-card.neutral { background: linear-gradient(135deg, #7a6aaa, #6a5a9a); }
        .summary-card h3 { font-size: 0.9rem; margin-bottom: 10px; opacity: 0.9; }
        .summary-card .amount { font-size: 1.6rem; font-weight: bold; }
        .warning-box { background: #fff3cd; border: 1px solid #ffc107; color: #856404; padding: 12px 16px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9rem; display: none; }
        .chart-container { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .chart-controls { display: flex; gap: 10px; }
        .export-btn, .theme-toggle { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: background-color 0.3s ease; }
        .export-btn { background: #3498db; color: white; }
        .export-btn:hover { background: #2980b9; }
        .theme-toggle { background: #f39c12; color: white; font-size: 1.1rem; }
        .theme-toggle:hover { background: #e67e22; }
        .chart-wrapper { position: relative; height: 400px; width: 100%; }
        .timeline-table { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow-x: auto; }
        .timeline-table table { width: 100%; border-collapse: collapse; }
        .timeline-table th { background: #34495e; color: white; padding: 15px; text-align: right; font-weight: bold; }
        .timeline-table td { padding: 12px 15px; border-bottom: 1px solid #e0e0e0; text-align: right; }
        .timeline-table .year-col { background: #f8f9fa; font-weight: bold; }
        .timeline-table .deposit-col, .timeline-table .total-deposit-col { background: rgba(52,152,219,0.1); color: #2980b9; }
        .timeline-table .earnings-col, .timeline-table .total-earnings-col { background: rgba(39,174,96,0.1); color: #27ae60; }
        .timeline-table .balance-col { background: rgba(231,76,60,0.1); color: #e74c3c; font-weight: bold; }
        .timeline-table .real-value-col { background: rgba(155,89,182,0.1); color: #9b59b6; }
        .timeline-table tr:hover { background: #f8f9fa; }
        .hidden { display: none; }
        .note { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 8px; margin-top: 20px; font-size: 0.9rem; }
        .field-hint { font-size: 0.78rem; color: #888; margin-top: 4px; }

        /* âœ… Ø¥ØµÙ„Ø§Ø­: ØªØ¹Ø±ÙŠÙ ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© */
        .results-panel { border-right: 4px solid transparent; transition: border-color 0.4s ease; }
        .results-panel.result-positive { border-right: 4px solid #27ae60; }
        .results-panel.result-warning  { border-right: 4px solid #f39c12; }
        .results-panel.result-negative { border-right: 4px solid #e74c3c; }

        @media (max-width: 968px) { .calculator-container { grid-template-columns: 1fr; } .form-row { grid-template-columns: 1fr; } .summary-cards { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<div class="container">
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">ğŸ“ˆ Ù…ÙÙƒØ±Ø© Ù…Ø³ØªØ«Ù…Ø±</a>
            <button class="navbar-toggle" onclick="toggleNavbar()">â˜°</button>
            <div class="navbar-menu" id="navbarMenu">
                <a href="index.html"                     class="navbar-item">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="advice.html"                    class="navbar-item calculator">ğŸ’° ØµØ§ÙÙŠ Ø§Ù„Ø«Ø±ÙˆØ©</a>
                <a href="salary_calculator.html"         class="navbar-item salary">ğŸ’¼ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø±Ø§ØªØ¨</a>
                <a href="zakat_purification.html"        class="navbar-item zakat">ğŸ•Œ Ø§Ù„Ø²ÙƒØ§Ø©</a>
                <a href="financial_freedom.html"         class="navbar-item fire">ğŸ”¥ Ø§Ù„Ø­Ø±ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</a>
                <a href="investor_tips.html"             class="navbar-item tips">âš ï¸ Ù†ØµØ§Ø¦Ø­</a>
                <a href="snowball_calculator.html"       class="navbar-item calculator active">â„ï¸ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨</a>
                <a href="emergency_fund_calculator.html" class="navbar-item emergency">ğŸ›¡ï¸ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</a>
                <a href="average_calculator.html"        class="navbar-item average">ğŸ“Š Ù…ØªÙˆØ³Ø· Ø§Ù„Ø´Ø±Ø§Ø¡</a>
                <a href="company_valuation.html"         class="navbar-item company">ğŸ¢ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø±ÙƒØ©</a>
                <a href="retirement_calculator.html"     class="navbar-item retirement">ğŸ–ï¸ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</a>
                <a href="portfolio_rating.html"          class="navbar-item portfolio">ğŸ›¡ï¸ Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
                <a href="stock_valuation.html"           class="navbar-item calculator">ğŸ“Š ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø³Ù‡Ù…</a>
                <a href="dca_calculator.html"            class="navbar-item calculator">ğŸ“… DCA</a>
                <a href="sell_decision.html"             class="navbar-item calculator">ğŸ¤” Ù‡Ù„ Ø£Ø¨ÙŠØ¹ØŸ</a>
                <a href="goal_calculator.html"           class="navbar-item calculator">ğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¹ÙƒØ³ÙŠ</a>
                <a href="allocation_calculator.html"     class="navbar-item allocation">âš–ï¸ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­ÙØ¸Ø©</a>
            </div>
        </div>
    </nav>
    <script>
        function toggleNavbar(){document.getElementById('navbarMenu').classList.toggle('open');}
        document.addEventListener('DOMContentLoaded', function(){
            const page = (window.location.pathname.split('/').pop() || 'index.html').split('?')[0] || 'index.html';
            document.querySelectorAll('.navbar-item').forEach(function(el){
                el.classList.remove('active');
                if ((el.getAttribute('href') || '').split('?')[0] === page) el.classList.add('active');
            });
        });
    </script>

    <div class="header">
        <h1>â„ï¸ Ø­Ø§Ø³Ø¨Ø© ÙƒØ±Ø© Ø§Ù„Ø«Ù„Ø¬</h1>
        <p>Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨ ÙˆØ´Ø§Ù‡Ø¯ ÙƒÙŠÙ ØªÙ†Ù…Ùˆ Ø«Ø±ÙˆØªÙƒ Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª</p>
    </div>

    <div class="calculator-container">
        <div class="input-panel">
            <h2 class="section-title">ğŸ“Š Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª</h2>

            <div class="form-group">
                <label for="principal">Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ«Ù…Ø± (Ø±ÙŠØ§Ù„)</label>
                <input type="number" id="principal" value="10000" min="0" step="100">
            </div>

            <div class="form-group">
                <label for="additionalDeposit">Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ (Ø±ÙŠØ§Ù„)</label>
                <input type="number" id="additionalDeposit" value="500" min="0" step="50">
            </div>

            <div class="form-group">
                <label for="depositFrequency">ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</label>
                <select id="depositFrequency">
                    <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                    <option value="quarterly">Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ</option>
                    <option value="semiannually">Ù†ØµÙ Ø³Ù†ÙˆÙŠ</option>
                    <option value="annually">Ø³Ù†ÙˆÙŠ</option>
                </select>
            </div>

            <div class="form-group">
                <label>ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</label>
                <div class="radio-group">
                    <label class="radio-option"><input type="radio" name="depositTiming" value="beginning" checked><span>Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©</span></label>
                    <label class="radio-option"><input type="radio" name="depositTiming" value="end"><span>Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©</span></label>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <!-- âœ… Ø¥ØµÙ„Ø§Ø­: Ø§Ù„ØªØ³Ù…ÙŠØ© ØªØªØºÙŠØ± Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ DRIP -->
                    <label for="returnRate" id="returnRateLabel">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (%)</label>
                    <input type="number" id="returnRate" value="8" min="-50" max="100" step="0.1">
                </div>
                <div class="form-group">
                    <label for="rateType">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø§Ø¦Ø¯</label>
                    <select id="rateType">
                        <option value="annually">Ø³Ù†ÙˆÙŠ</option>
                        <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="years">Ù…Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± (Ø³Ù†ÙˆØ§Øª)</label>
                <input type="number" id="years" value="10" min="1" max="50" step="1">
            </div>

            <div class="checkbox-group">
                <label for="dripEnabled">
                    <input type="checkbox" id="dripEnabled">
                    ØªÙØ¹ÙŠÙ„ DRIP (Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª)
                </label>
            </div>

            <div class="form-group hidden" id="dividendGroup">
                <label for="dividendYield">Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ© (%)</label>
                <input type="number" id="dividendYield" value="3" min="0" max="20" step="0.1">
                <!-- âœ… Ø¥ØµÙ„Ø§Ø­: ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ§Ø¶Ø­ Ù„Ù…Ù†Ø¹ Ù…Ø¶Ø§Ø¹ÙØ© Ø§Ù„Ø¹Ø§Ø¦Ø¯ -->
                <p class="field-hint">âš ï¸ Ø£Ø¯Ø®Ù„ Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª ÙÙ‚Ø· â€” ÙˆØªØ£ÙƒØ¯ Ø£Ù† Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø£Ø¹Ù„Ø§Ù‡ ÙŠÙ…Ø«Ù„ Ù†Ù…Ùˆ Ø§Ù„Ø³Ø¹Ø± Ø­ØµØ±Ø§Ù‹ ÙˆÙ„ÙŠØ³ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„ÙƒÙ„ÙŠ.</p>
            </div>

            <div class="form-group">
                <label for="inflationRate">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ¶Ø®Ù… (%) â€” Ø§Ø®ØªÙŠØ§Ø±ÙŠ</label>
                <input type="number" id="inflationRate" value="2" min="0" max="50" step="0.1">
            </div>

            <div class="form-group">
                <label for="depositIncrease">Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© ÙÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ (%) â€” Ø§Ø®ØªÙŠØ§Ø±ÙŠ</label>
                <input type="number" id="depositIncrease" value="0" min="0" max="100" step="1">
                <!-- âœ… Ø¥ØµÙ„Ø§Ø­: ØªÙˆØ¶ÙŠØ­ Ø³Ù„ÙˆÙƒ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© -->
                <p class="field-hint">ØªÙØ·Ø¨ÙÙ‘Ù‚ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø¨Ø¯Ø¡Ø§Ù‹ Ù…Ù† Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©.</p>
            </div>

            <button class="calculate-btn" onclick="calculateCompoundInterest()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ</button>

            <div class="note">ğŸ’¡ <strong>Ù†ØµÙŠØ­Ø©:</strong> DRIP ÙŠØ²ÙŠØ¯ Ù…Ù† ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨ Ø¹Ø¨Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙÙˆØ±Ø§Ù‹. ØªØ£ÙƒØ¯ Ø£Ù† Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø¯Ø®Ù„ ÙŠÙ…Ø«Ù„ Ù†Ù…Ùˆ Ø§Ù„Ø³Ø¹Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„Ù‡.</div>
        </div>

        <div class="results-panel" id="resultsPanel">
            <h2 class="section-title">ğŸ“ˆ Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
            <div id="warningBox" class="warning-box"></div>

            <div class="summary-cards">
                <div class="summary-card deposits"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</h3><div class="amount" id="totalDeposits">-</div></div>
                <div class="summary-card earnings"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3><div class="amount" id="totalEarnings">-</div></div>
                <div class="summary-card final"><h3>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3><div class="amount" id="finalValue">-</div></div>
            </div>

            <div class="summary-cards">
                <div class="summary-card neutral"><h3>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</h3><div class="amount" id="realValue">-</div></div>
                <div class="summary-card neutral"><h3>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (%)</h3><div class="amount" id="totalReturn">-</div></div>
                <!-- âœ… Ø¥ØµÙ„Ø§Ø­: ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ù† CAGR Ø¥Ù„Ù‰ IRR -->
                <div class="summary-card neutral"><h3>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ (IRR)</h3><div class="amount" id="cagr">-</div></div>
            </div>

            <div class="summary-cards" style="grid-template-columns:1fr 1fr; gap:20px">
                <div class="summary-card final" id="cardMillion"><h3>Ø³Ù†ÙˆØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ù„ÙŠÙˆÙ†</h3><div class="amount" id="yearsToMillion">-</div></div>
                <div class="summary-card earnings" id="cardRatio"><h3>Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</h3><div class="amount" id="earningsRatio">-</div></div>
            </div>
        </div>
    </div>

    <div class="chart-container hidden" id="chartSection">
        <div class="chart-header">
            <h2 class="section-title">ğŸ“Š Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù†Ù…Ùˆ Ø§Ù„Ø«Ø±ÙˆØ©</h2>
            <div class="chart-controls">
                <button class="export-btn" onclick="exportToCSV()">ØªØµØ¯ÙŠØ± CSV</button>
                <button class="export-btn" onclick="exportToPDF()">ØªØµØ¯ÙŠØ± PDF</button>
                <button class="theme-toggle" onclick="toggleChartTheme()">ğŸŒ™</button>
            </div>
        </div>
        <div class="chart-wrapper"><canvas id="wealthChart"></canvas></div>
    </div>

    <div class="timeline-table hidden" id="timelineSection">
        <h2 class="section-title">ğŸ“… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</h2>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ø³Ù†Ø©</th>
                    <th>Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„Ø³Ù†ÙˆÙŠ</th>
                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</th>
                    <th>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠØ©</th>
                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</th>
                    <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                    <th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</th>
                </tr>
            </thead>
            <tbody id="timelineBody"></tbody>
        </table>
    </div>
</div>

<script src="results-engine.js"></script>
<script>
let wealthChart = null;
window.currentTimelineData = [];

function formatCurrency(a) {
    return new Intl.NumberFormat('ar-SA', { style: 'currency', currency: 'SAR', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(a);
}
function formatPercent(v) { return v.toFixed(2) + '%'; }
function getDepositsPerYear(f) { return { monthly: 12, quarterly: 4, semiannually: 2, annually: 1 }[f] ?? 12; }

// ============================================================
// âœ… Ø¥ØµÙ„Ø§Ø­ Ø­Ø±Ø¬: Ø¯Ø§Ù„Ø© IRR Ø¨Ø¯ÙŠÙ„Ø§Ù‹ Ø¹Ù† CAGR Ø§Ù„Ù…Ø¶Ù„Ù„
// CAGR = (FV/PV)^(1/n) - 1 ØµØ­ÙŠØ­ ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø¯ÙˆØ±ÙŠØ©.
// IRR = Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø°ÙŠ ÙŠØ¬Ø¹Ù„ NPV = 0 â†’ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„ØµØ­ÙŠØ­ Ù‡Ù†Ø§.
// ============================================================
function calculateIRR(cashflows) {
    let irr = 0.1;
    for (let i = 0; i < 300; i++) {
        let npv  = 0;
        let dnpv = 0;
        for (let t = 0; t < cashflows.length; t++) {
            const disc = Math.pow(1 + irr, t);
            npv  += cashflows[t] / disc;
            dnpv -= t * cashflows[t] / (disc * (1 + irr));
        }
        if (Math.abs(dnpv) < 1e-12) break;
        const step = npv / dnpv;
        irr -= step;
        if (Math.abs(step) < 1e-10) break;
        // Ù…Ù†Ø¹ Ø§Ù„Ù€ IRR Ù…Ù† Ø§Ù„Ø§Ù†Ø¬Ø±Ø§Ù Ù„Ù‚ÙŠÙ… Ø³Ø§Ù„Ø¨Ø© ÙƒØ¨ÙŠØ±Ø©
        if (irr < -0.999) { irr = 0.001; }
    }
    return irr * 100;
}

function calculateCompoundInterest() {
    const principal         = Math.max(parseFloat(document.getElementById('principal').value)         || 0, 0);
    const additionalDeposit = Math.max(parseFloat(document.getElementById('additionalDeposit').value) || 0, 0);
    const depositFrequency  = document.getElementById('depositFrequency').value;
    const depositTiming     = document.querySelector('input[name="depositTiming"]:checked').value;
    const returnRate        = Math.max(parseFloat(document.getElementById('returnRate').value)        || 0, 0);
    const rateType          = document.getElementById('rateType').value;
    const years             = Math.max(parseInt(document.getElementById('years').value)               || 1, 1);
    const dripEnabled       = document.getElementById('dripEnabled').checked;
    const dividendYield     = dripEnabled ? Math.max(parseFloat(document.getElementById('dividendYield').value) || 0, 0) : 0;
    const inflationRate     = Math.max(parseFloat(document.getElementById('inflationRate').value)    || 0, 0);
    const depositIncrease   = Math.max(parseFloat(document.getElementById('depositIncrease').value)  || 0, 0);

    // Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ù…Ùˆ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ø§Ø³Ù…ÙŠ
    const annualNominalRate = rateType === 'monthly'
        ? Math.pow(1 + returnRate / 100, 12) - 1
        : returnRate / 100;

    // Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ¹Ù„ÙŠ: Ù…Ø¹ DRIP Ù†Ø¶Ø±Ø¨ Ù†Ù…Ùˆ Ø§Ù„Ø³Ø¹Ø± Ã— Ù†Ù…Ùˆ Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ø¯Ø©
    // âœ… Ù‡Ø°Ø§ ØµØ­ÙŠØ­ Ø±ÙŠØ§Ø¶ÙŠØ§Ù‹ Ø¨Ø´Ø±Ø· Ø£Ù† returnRate = Ù†Ù…Ùˆ Ø§Ù„Ø³Ø¹Ø± ÙÙ‚Ø·
    const effectiveAnnualRate = dripEnabled
        ? (1 + annualNominalRate) * (1 + dividendYield / 100) - 1
        : annualNominalRate;

    const depositsPerYear = getDepositsPerYear(depositFrequency);
    const periodRate      = Math.pow(1 + effectiveAnnualRate, 1 / depositsPerYear) - 1;

    const timelineData = [];
    let balance              = principal;
    let totalDeposited       = principal;
    let totalEarnings        = 0;
    let currentPeriodDeposit = additionalDeposit;

    timelineData.push({
        year: 0,
        yearlyDeposits: 0,
        totalDeposits: totalDeposited,
        yearlyEarnings: 0,
        totalEarnings: 0,
        balance,
        realValue: balance
    });

    for (let year = 1; year <= years; year++) {
        // âœ… Ø§Ù„Ø²ÙŠØ§Ø¯Ø© ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© â€” Ø³Ù„ÙˆÙƒ ØµØ­ÙŠØ­ ÙˆÙ…ÙÙˆØ«ÙÙ‘Ù‚ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        if (year > 1 && depositIncrease > 0) {
            currentPeriodDeposit *= (1 + depositIncrease / 100);
        }

        const balanceAtStartOfYear = balance;
        const annualDepositAmount  = currentPeriodDeposit * depositsPerYear;

        for (let p = 0; p < depositsPerYear; p++) {
            if (depositTiming === 'beginning') {
                balance = (balance + currentPeriodDeposit) * (1 + periodRate);
            } else {
                balance = balance * (1 + periodRate) + currentPeriodDeposit;
            }
        }

        const yearlyEarnings = balance - balanceAtStartOfYear - annualDepositAmount;
        totalDeposited += annualDepositAmount;
        totalEarnings  += yearlyEarnings;
        const realValue = balance / Math.pow(1 + inflationRate / 100, year);

        timelineData.push({ year, yearlyDeposits: annualDepositAmount, totalDeposits: totalDeposited, yearlyEarnings, totalEarnings, balance, realValue });
    }

    window.currentTimelineData = timelineData;
    displayResults(timelineData, principal, years, additionalDeposit, depositIncrease, depositsPerYear);
    displayChart(timelineData);
    displayTimeline(timelineData);
}

function displayResults(data, principal, years, additionalDeposit, depositIncrease, depositsPerYear) {
    const last         = data[data.length - 1];
    const totalDeposits  = last.totalDeposits;
    const totalEarnings  = last.totalEarnings;
    const finalBalance   = last.balance;
    const realValue      = last.realValue;
    const totalReturn    = ((finalBalance - totalDeposits) / totalDeposits) * 100;
    const earningsRatio  = (totalEarnings / finalBalance) * 100;

    // ============================================================
    // âœ… Ø¥ØµÙ„Ø§Ø­ Ø­Ø±Ø¬: Ø§Ø³ØªØ¨Ø¯Ø§Ù„ CAGR Ø¨Ù€ IRR
    //
    // CAGR Ø§Ù„Ù‚Ø¯ÙŠÙ…: (FV / principal)^(1/n) - 1
    // Ù‡Ø°Ø§ ÙŠÙÙ‚Ø§Ø±Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ÙˆÙ„ÙŠ ÙÙ‚Ø·ØŒ
    // Ù…ØªØ¬Ø§Ù‡Ù„Ø§Ù‹ ÙƒÙ„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ© â†’ ÙŠÙØ¶Ø®Ù‘Ù… Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±.
    //
    // Ù…Ø«Ø§Ù„: 10K Ø£ÙˆÙ„ÙŠ + 500/Ø´Ù‡Ø± + 8%/Ø³Ù†Ø© Ã— 10 Ø³Ù†ÙˆØ§Øª
    // CAGR Ø§Ù„Ù‚Ø¯ÙŠÙ…: 27.35% â† Ø®Ø·Ø£
    // IRR Ø§Ù„ØµØ­ÙŠØ­:   8.60% â† ØµØ­ÙŠØ­
    // ============================================================
    const cashflows = [-principal];
    let dep = additionalDeposit;
    for (let y = 1; y <= years; y++) {
        if (y > 1 && depositIncrease > 0) dep *= (1 + depositIncrease / 100);
        let cf = -(dep * depositsPerYear);
        if (y === years) cf += finalBalance;
        cashflows.push(cf);
    }
    const irr = calculateIRR(cashflows);

    document.getElementById('totalDeposits').textContent = formatCurrency(totalDeposits);
    document.getElementById('totalEarnings').textContent = formatCurrency(totalEarnings);
    document.getElementById('finalValue').textContent    = formatCurrency(finalBalance);
    document.getElementById('realValue').textContent     = formatCurrency(realValue);
    document.getElementById('totalReturn').textContent   = formatPercent(totalReturn);
    document.getElementById('cagr').textContent          = formatPercent(irr);    // â† IRR Ø§Ù„Ø¢Ù†
    document.getElementById('earningsRatio').textContent = formatPercent(earningsRatio);

    // ØªØ­Ø°ÙŠØ± Ø§Ù„ÙØ§Ø±Ù‚ Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ² 1 Ø±ÙŠØ§Ù„ Ù†ØªÙŠØ¬Ø© Ø¯Ù‚Ø© Ø§Ù„ÙØ§ØµÙ„Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©)
    const diff = Math.abs(finalBalance - (totalDeposits + totalEarnings));
    const warningBox = document.getElementById('warningBox');
    if (diff > 1) {
        warningBox.style.display = 'block';
        warningBox.textContent = `âš ï¸ ÙØ§Ø±Ù‚ Ø­Ø³Ø§Ø¨ÙŠ ØµØºÙŠØ± (${formatCurrency(diff)}) Ù†Ø§ØªØ¬ Ø¹Ù† ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„ÙØªØ±Ø§Øª.`;
    } else {
        warningBox.style.display = 'none';
    }

    const milTarget = data.find(d => d.balance >= 1000000);
    document.getElementById('yearsToMillion').textContent = milTarget ? `${milTarget.year} Ø³Ù†Ø©` : 'Ù„Ù… ÙŠØµÙ„ Ù„Ù„Ù…Ù„ÙŠÙˆÙ†';

    // âœ… Ø¥ØµÙ„Ø§Ø­: Ø§Ù„ÙƒÙ„Ø§Ø³Ø§Øª ÙƒØ§Ù†Øª Ù…Ø¹Ø±Ù‘ÙØ© ÙÙŠ JS Ù„ÙƒÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ CSS â€” ØªÙ… ØªØ¹Ø±ÙŠÙÙ‡Ø§ Ø§Ù„Ø¢Ù†
    const panel = document.getElementById('resultsPanel');
    panel.classList.remove('result-positive', 'result-negative', 'result-warning');
    if (earningsRatio >= 50)      panel.classList.add('result-positive');
    else if (earningsRatio >= 25) panel.classList.add('result-warning');
    else                          panel.classList.add('result-negative');

    if (window.ResultsEngine) window.ResultsEngine.paint();
}

function displayChart(data) {
    const ctx      = document.getElementById('wealthChart').getContext('2d');
    const labels   = data.map(d => 'Ø§Ù„Ø³Ù†Ø© ' + d.year);
    const deposits = data.map(d => d.totalDeposits);
    const earnings = data.map(d => d.totalEarnings);
    const total    = data.map(d => d.balance);
    const real     = data.map(d => d.realValue);

    if (wealthChart) wealthChart.destroy();
    wealthChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels,
            datasets: [
                { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª', data: deposits, borderColor: '#3498db', backgroundColor: 'rgba(52,152,219,0.1)', borderWidth: 3, fill: true, tension: 0.4 },
                { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­',   data: earnings, borderColor: '#27ae60', backgroundColor: 'rgba(39,174,96,0.1)',  borderWidth: 3, fill: true, tension: 0.4 },
                { label: 'Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',  data: total,    borderColor: '#e74c3c', backgroundColor: 'rgba(231,76,60,0.05)', borderWidth: 3, fill: false, tension: 0.4 },
                { label: 'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©',  data: real,     borderColor: '#9b59b6', backgroundColor: 'rgba(155,89,182,0.05)', borderWidth: 2, borderDash: [6, 3], fill: false, tension: 0.4 }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'top' },
                tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + formatCurrency(ctx.parsed.y) } }
            },
            scales: { y: { beginAtZero: true, ticks: { callback: v => formatCurrency(v) } } }
        }
    });
    document.getElementById('chartSection').classList.remove('hidden');
}

function displayTimeline(data) {
    const tbody = document.getElementById('timelineBody');
    tbody.innerHTML = '';
    data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td class="year-col">${row.year}</td>
            <td class="deposit-col">${formatCurrency(row.yearlyDeposits)}</td>
            <td class="total-deposit-col">${formatCurrency(row.totalDeposits)}</td>
            <td class="earnings-col">${formatCurrency(row.yearlyEarnings)}</td>
            <td class="total-earnings-col">${formatCurrency(row.totalEarnings)}</td>
            <td class="balance-col"><strong>${formatCurrency(row.balance)}</strong></td>
            <td class="real-value-col">${formatCurrency(row.realValue)}</td>`;
        tbody.appendChild(tr);
    });
    document.getElementById('timelineSection').classList.remove('hidden');
}

function exportToCSV() {
    const data = window.currentTimelineData;
    if (!data || data.length === 0) { alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.'); return; }
    const BOM = '\uFEFF';
    let csv = BOM + 'Ø§Ù„Ø³Ù†Ø©,Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„Ø³Ù†ÙˆÙŠ,Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª,Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠØ©,Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­,Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ,Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©\n';
    data.forEach(r => {
        csv += [r.year, r.yearlyDeposits.toFixed(2), r.totalDeposits.toFixed(2), r.yearlyEarnings.toFixed(2), r.totalEarnings.toFixed(2), r.balance.toFixed(2), r.realValue.toFixed(2)].join(',') + '\n';
    });
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'snowball_results.csv';
    link.style.display = 'none';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function exportToPDF() { window.print(); }

function toggleChartTheme() {
    const isDark = document.body.classList.toggle('dark-theme');
    if (!wealthChart) return;
    const textColor = isDark ? '#e0e0e0' : '#2c3e50';
    const gridColor = isDark ? '#444'    : '#e0e0e0';
    wealthChart.options.plugins.legend.labels.color = textColor;
    ['x', 'y'].forEach(a => {
        wealthChart.options.scales[a].ticks.color = textColor;
        wealthChart.options.scales[a].grid.color  = gridColor;
    });
    wealthChart.update();
}

// âœ… Ø¥ØµÙ„Ø§Ø­: ØªØºÙŠÙŠØ± ØªØ³Ù…ÙŠØ© Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ DRIP Ù„Ù…Ù†Ø¹ Ù…Ø¶Ø§Ø¹ÙØ© Ø§Ù„Ø¹Ø§Ø¦Ø¯
document.getElementById('dripEnabled').addEventListener('change', function () {
    document.getElementById('dividendGroup').classList.toggle('hidden', !this.checked);
    document.getElementById('returnRateLabel').textContent = this.checked
        ? 'Ù…Ø¹Ø¯Ù„ Ù†Ù…Ùˆ Ø§Ù„Ø³Ø¹Ø± ÙÙ‚Ø· (%) â€” Ø¨Ø¯ÙˆÙ† Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª'
        : 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (%)';
});

window.addEventListener('load', calculateCompoundInterest);
</script>
<script data-goatcounter="https://investornote.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
